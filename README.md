# Whale Staking Contract

ä¸€ä¸ªåŸºäº HashKey Layer2 ç½‘ç»œçš„å»ä¸­å¿ƒåŒ–è´¨æŠ¼åˆçº¦ï¼Œæ”¯æŒå¤šé”å®šæœŸé€‰é¡¹ã€ç™½åå•æœºåˆ¶å’Œå¯å‡çº§ä»£ç†æ¨¡å¼ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [åˆçº¦æ¶æ„](#åˆçº¦æ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åˆçº¦æ¥å£](#åˆçº¦æ¥å£)
- [é”å®šæœŸé€‰é¡¹](#é”å®šæœŸé€‰é¡¹)
- [å¥–åŠ±è®¡ç®—](#å¥–åŠ±è®¡ç®—)
- [å®‰å…¨ç‰¹æ€§](#å®‰å…¨ç‰¹æ€§)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [è„šæœ¬è¯´æ˜](#è„šæœ¬è¯´æ˜)
- [æµ‹è¯•](#æµ‹è¯•)
- [è®¸å¯è¯](#è®¸å¯è¯)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å›ºå®šé”å®šæœŸ**ï¼šå›ºå®š365å¤©é”å®šæœŸï¼Œç®€åŒ–ç”¨æˆ·é€‰æ‹©ï¼Œç»Ÿä¸€ç®¡ç†
- **å¯å‡çº§ä»£ç†**ï¼šé‡‡ç”¨ Transparent Proxy ä»£ç†æ¨¡å¼ï¼Œæ”¯æŒåˆçº¦å‡çº§
- **ç™½åå•æœºåˆ¶**ï¼šæ”¯æŒç™½åå•æ¨¡å¼ï¼Œå¯é™åˆ¶åªæœ‰ç™½åå•ç”¨æˆ·æ‰èƒ½è´¨æŠ¼
- **è´¨æŠ¼æ—¶é—´æ§åˆ¶**ï¼šæ”¯æŒè®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œçµæ´»æ§åˆ¶è´¨æŠ¼æ—¶é—´çª—å£
- **å¥–åŠ±æ± ç®¡ç†**ï¼šç‹¬ç«‹çš„å¥–åŠ±æ± ç³»ç»Ÿï¼Œç¡®ä¿å¥–åŠ±åˆ†é…çš„å®‰å…¨æ€§
- **å›ºå®šæ”¶ç›Šç‡**ï¼šéƒ¨ç½²æ—¶é…ç½®å›ºå®šå¹´åŒ–æ”¶ç›Šç‡ï¼ˆ8% æˆ– 16%ï¼‰ï¼Œæ¸…æ™°æ˜ç¡®

### å®‰å…¨ç‰¹æ€§
- **é‡å…¥æ”»å‡»é˜²æŠ¤**ï¼šä½¿ç”¨ OpenZeppelin çš„ ReentrancyGuard
- **ç´§æ€¥æ¨¡å¼**ï¼šæ”¯æŒç´§æ€¥æš‚åœå’Œç´§æ€¥æå–ï¼ˆä»…æå–æœ¬é‡‘ï¼‰
- **æš‚åœæœºåˆ¶**ï¼šæ‰€æœ‰è€…å¯æš‚åœåˆçº¦åŠŸèƒ½
- **è®¿é—®æ§åˆ¶**ï¼šåŸºäº OpenZeppelin Ownable çš„æ‰€æœ‰æƒç®¡ç†

## ğŸ—ï¸ åˆçº¦æ¶æ„

### åˆçº¦æ–‡ä»¶ç»“æ„

```
contracts/
â”œâ”€â”€ staking.sol              # Layer2Staking V1.0.0 ä¸»åˆçº¦
â”œâ”€â”€ Layer2StakingV2.sol      # Layer2Staking V1.0.1 å‡çº§ç‰ˆæœ¬
â”œâ”€â”€ StakingStorage.sol       # å­˜å‚¨å±‚åˆçº¦ï¼ˆå®šä¹‰æ‰€æœ‰çŠ¶æ€å˜é‡ï¼‰
â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ IStake.sol          # ä¸»è¦æ¥å£å®šä¹‰
â”‚   â””â”€â”€ IStaking.sol        # è´¨æŠ¼æ¥å£
â””â”€â”€ libraries/
    â””â”€â”€ StakingLib.sol      # å¥–åŠ±è®¡ç®—å’ŒéªŒè¯åº“
```

### åˆçº¦ç»§æ‰¿å…³ç³»

```
Layer2StakingV2
â”œâ”€â”€ IStaking (æ¥å£)
â”œâ”€â”€ StakingStorage (å­˜å‚¨å±‚ï¼Œç»§æ‰¿ OwnableUpgradeable)
â”œâ”€â”€ ReentrancyGuardUpgradeable (é‡å…¥ä¿æŠ¤)
â””â”€â”€ PausableUpgradeable (æš‚åœåŠŸèƒ½)

StakingStorage
â”œâ”€â”€ Initializable (åˆå§‹åŒ–æ§åˆ¶)
â””â”€â”€ OwnableUpgradeable (æ‰€æœ‰æƒç®¡ç†)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- npm, yarn æˆ– pnpm

### å®‰è£…ä¾èµ–

```bash
npm install
# æˆ–
yarn install
# æˆ–
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
PRIVATE_KEY=your_private_key_here
```

### ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

### è¿è¡Œæµ‹è¯•

```bash
npx hardhat test
```

## ğŸ“– åˆçº¦æ¥å£

### ç”¨æˆ·åŠŸèƒ½

#### `stake() payable`
åˆ›å»ºæ–°çš„è´¨æŠ¼ä½ç½®ï¼ˆå›ºå®š365å¤©é”å®šæœŸï¼‰
- **å‚æ•°**: æ— å‚æ•°ï¼Œé€šè¿‡ `msg.value` å‘é€è´¨æŠ¼é‡‘é¢ï¼Œé”å®šæœŸå›ºå®šä¸º365å¤©
- **è¿”å›**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¦æ±‚**: 
  - å½“å‰æ—¶é—´å¿…é¡»åœ¨è´¨æŠ¼æ—¶é—´çª—å£å†…ï¼ˆ`stakeStartTime <= now < stakeEndTime`ï¼‰
  - å¦‚æœå¯ç”¨ç™½åå•æ¨¡å¼ï¼Œå¿…é¡»æ˜¯ç™½åå•ç”¨æˆ·
  - è´¨æŠ¼é‡‘é¢ >= æœ€å°è´¨æŠ¼é‡‘é¢
  - æ€»è´¨æŠ¼é‡ä¸èƒ½è¶…è¿‡æœ€å¤§é™åˆ¶
  - å¥–åŠ±æ± ä½™é¢å……è¶³

#### `unstake(uint256 positionId)`
è§£é™¤è´¨æŠ¼å¹¶æå–æœ¬é‡‘å’Œå¥–åŠ±
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: è‡ªåŠ¨è½¬è´¦æœ¬é‡‘å’Œå¥–åŠ±åˆ°è°ƒç”¨è€…åœ°å€
- **è¦æ±‚**: 
  - å¿…é¡»æ˜¯ä½ç½®æ‰€æœ‰è€…
  - é”å®šæœŸå·²ç»“æŸï¼ˆ365å¤©ï¼‰
- **æå–é‡‘é¢**: æœ¬é‡‘ + å…¨éƒ¨ç´¯ç§¯å¥–åŠ±

#### `claimReward(uint256 positionId)`
æå–å¥–åŠ±ï¼ˆä¸è§£é™¤è´¨æŠ¼ï¼‰
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: `reward` - æå–çš„å¥–åŠ±é‡‘é¢
- **è¦æ±‚**: å¿…é¡»æœ‰æœªæå–çš„å¥–åŠ±

#### `pendingReward(uint256 positionId)`
æŸ¥è¯¢å¾…æå–å¥–åŠ±
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: `reward` - å¾…æå–å¥–åŠ±é‡‘é¢

#### æŸ¥çœ‹ç”¨æˆ·è´¨æŠ¼ä½ç½®
é€šè¿‡ `userPositions(address user, uint256 index)` æŸ¥çœ‹
- **è¯´æ˜**: `userPositions` æ˜¯ public mappingï¼ŒSolidity è‡ªåŠ¨ç”Ÿæˆ getter å‡½æ•°
- éœ€è¦éå†ç´¢å¼•è·å–æ‰€æœ‰ä½ç½®

### ç®¡ç†å‘˜åŠŸèƒ½

#### `updateWhitelistBatch(address[] calldata users, bool status)`
æ‰¹é‡æ›´æ–°ç™½åå•
- **å‚æ•°**: 
  - `users` - ç”¨æˆ·åœ°å€æ•°ç»„ï¼ˆæœ€å¤š100ä¸ªï¼‰
  - `status` - true æ·»åŠ åˆ°ç™½åå•ï¼Œfalse ä»ç™½åå•ç§»é™¤

#### `setWhitelistOnlyMode(bool enabled)`
å¯ç”¨/ç¦ç”¨ç™½åå•æ¨¡å¼

#### `setMaxTotalStake(uint256 newLimit)`
è®¾ç½®æœ€å¤§æ€»è´¨æŠ¼é‡

#### `setStakeStartTime(uint256 newStartTime)`
è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´
- **å‚æ•°**: `newStartTime` - è´¨æŠ¼å¼€å§‹æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
- **è¯´æ˜**: ç”¨æˆ·åªèƒ½åœ¨ `stakeStartTime` ä¹‹åå¼€å§‹è´¨æŠ¼

#### `setStakeEndTime(uint256 newEndTime)`
è®¾ç½®è´¨æŠ¼æˆªæ­¢æ—¶é—´
- **å‚æ•°**: `newEndTime` - è´¨æŠ¼ç»“æŸæ—¶é—´æˆ³ï¼ˆç§’ï¼‰
- **è¦æ±‚**: å¿…é¡»æ˜¯æœªæ¥çš„æ—¶é—´
- **è¯´æ˜**: ç”¨æˆ·åªèƒ½åœ¨ `stakeEndTime` ä¹‹å‰è´¨æŠ¼

#### `updateRewardPool()`
å‘å¥–åŠ±æ± å……å€¼

#### `enableEmergencyMode()`
å¯ç”¨ç´§æ€¥æ¨¡å¼ï¼ˆæš‚åœå¥–åŠ±åˆ†é…ï¼‰

#### `emergencyWithdraw(uint256 positionId)`
ç´§æ€¥æå–ï¼ˆä»…æå–æœ¬é‡‘ï¼Œä¸åŒ…å«å¥–åŠ±ï¼‰
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¦æ±‚**: 
  - å¿…é¡»åœ¨ç´§æ€¥æ¨¡å¼ä¸‹ï¼ˆç®¡ç†å‘˜å¯ç”¨ï¼‰
  - å¿…é¡»æ˜¯ä½ç½®æ‰€æœ‰è€…
  - **ä¸å—é”å®šæœŸé™åˆ¶**ï¼ˆå¯ä»¥éšæ—¶æå–ï¼‰
- **æå–é‡‘é¢**: ä»…æœ¬é‡‘ï¼Œ**ä¸åŒ…å«å¥–åŠ±**

## ğŸ”’ é”å®šæœŸå’Œæ”¶ç›Šç‡

### å›ºå®šé”å®šæœŸ

Layer2StakingV2 é‡‡ç”¨å›ºå®šé”å®šæœŸè®¾è®¡ï¼š

| å‚æ•° | é…ç½® | è¯´æ˜ |
|------|------|------|
| é”å®šæœŸ | 365 å¤© | å›ºå®šï¼Œä¸å¯ä¿®æ”¹ |
| æ”¶ç›Šç‡ | 8% æˆ– 16% | éƒ¨ç½²æ—¶é…ç½®ï¼ˆæ™®é€š/Premiumï¼‰ |

### å¥–åŠ±è®¡ç®—è¯´æ˜

**é‡è¦æœºåˆ¶**ï¼š
- å¥–åŠ±æŒ‰ç§’è¿ç»­ç´¯ç§¯ï¼Œç²¾ç¡®åˆ°ç§’ï¼Œå¯éšæ—¶æå–
- å¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸï¼Œå³ä½¿å®é™…è´¨æŠ¼æ—¶é—´æ›´é•¿

ä¾‹å¦‚ï¼š
- å›ºå®š 365 å¤©é”å®šæœŸï¼ˆ8% APYï¼‰
- å®é™…è´¨æŠ¼ 400 å¤©æ‰æå–
- **é‡è¦**ï¼šè¶…è¿‡é”å®šæœŸçš„æ—¶é—´ä¸ä¼šäº§ç”Ÿé¢å¤–å¥–åŠ±ï¼Œå¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸ

### è®¾è®¡ç†å¿µ

V2 ç‰ˆæœ¬ç®€åŒ–äº†é”å®šæœŸé€‰æ‹©ï¼š
- **ç”¨æˆ·å‹å¥½**ï¼šæ— éœ€é€‰æ‹©é”å®šæœŸï¼Œç®€åŒ–æ“ä½œæµç¨‹
- **ç»Ÿä¸€ç®¡ç†**ï¼šå›ºå®š365å¤©ï¼Œä¾¿äºè¿è¥å’Œç”¨æˆ·ç†è§£
- **æ¸…æ™°æ˜ç¡®**ï¼šé€šè¿‡ä¸åŒäº§å“ï¼ˆæ™®é€š/Premiumï¼‰æä¾›ä¸åŒæ”¶ç›Šç‡

## ğŸ”“ Unstake æœºåˆ¶è¯´æ˜

### æ­£å¸¸ Unstakeï¼ˆè§£é™¤è´¨æŠ¼ï¼‰

**æ—¶é—´é™åˆ¶**ï¼š
- å¿…é¡»ç­‰å¾…é”å®šæœŸå®Œå…¨ç»“æŸï¼ˆ365å¤©ï¼‰
- è§£é”æ¡ä»¶ï¼š`block.timestamp >= stakedAt + 365 days`

**æå–é‡‘é¢**ï¼š
- âœ… æœ¬é‡‘ + å…¨éƒ¨ç´¯ç§¯å¥–åŠ±
- å¥–åŠ±æŒ‰å®é™…è´¨æŠ¼æ—¶é—´è®¡ç®—ï¼ˆä½†ä¸è¶…è¿‡é”å®šæœŸï¼‰

**ç¤ºä¾‹**ï¼š
```
è´¨æŠ¼æ—¶é—´ï¼š2026-11-01 00:00:00
é”å®šæœŸï¼š365 å¤©
è§£é”æ—¶é—´ï¼š2027-11-01 00:00:00

å¯ä»¥æå–ï¼š2027-11-01 00:00:00 ä¹‹å
æå–é‡‘é¢ï¼šæœ¬é‡‘ + 365å¤©å†…çš„å¥–åŠ±
```

### ç´§æ€¥æå–ï¼ˆEmergency Withdrawï¼‰

**è§¦å‘æ¡ä»¶**ï¼š
- ç®¡ç†å‘˜å¿…é¡»å¯ç”¨ç´§æ€¥æ¨¡å¼ï¼ˆ`enableEmergencyMode()`ï¼‰
- ä¸å—é”å®šæœŸé™åˆ¶ï¼Œå¯ä»¥éšæ—¶æå–

**æå–é‡‘é¢**ï¼š
- âœ… ä»…æœ¬é‡‘
- âŒ ä¸åŒ…å«å¥–åŠ±

**ä½¿ç”¨åœºæ™¯**ï¼š
- åˆçº¦å‡ºç°ç´§æ€¥æƒ…å†µ
- éœ€è¦å¿«é€Ÿå›æ”¶èµ„é‡‘
- æ”¾å¼ƒå¥–åŠ±æ¢å–æå‰é€€å‡º

### æ€»ç»“å¯¹æ¯”

| æå–æ–¹å¼ | æ—¶é—´é™åˆ¶ | å¯æå–é‡‘é¢ | é€‚ç”¨åœºæ™¯ |
|---------|---------|-----------|---------|
| æ­£å¸¸ unstake | é”å®šæœŸç»“æŸï¼ˆ365å¤©ï¼‰ | æœ¬é‡‘ + å¥–åŠ± | æ­£å¸¸æƒ…å†µ |
| ç´§æ€¥æå– | æ— é™åˆ¶ï¼ˆéœ€ç´§æ€¥æ¨¡å¼ï¼‰ | ä»…æœ¬é‡‘ | ç´§æ€¥æƒ…å†µ |

### æ³¨æ„äº‹é¡¹

1. **ä¸¥æ ¼é”å®š**ï¼šå¿…é¡»ç­‰å¾…å®Œæ•´çš„365å¤©é”å®šæœŸï¼Œä¸æ”¯æŒæå‰æå–
2. **é”å®šæœŸå†…å¯æå–å¥–åŠ±**ï¼šè™½ç„¶ä¸èƒ½è§£é™¤è´¨æŠ¼ï¼Œä½†å¯ä»¥éšæ—¶æå–å·²ç´¯ç§¯çš„å¥–åŠ±
3. **ç´§æ€¥æ¨¡å¼**ï¼šåªæœ‰åœ¨ç®¡ç†å‘˜å¯ç”¨ç´§æ€¥æ¨¡å¼åæ‰èƒ½ä½¿ç”¨ç´§æ€¥æå–åŠŸèƒ½

## ğŸ’° å¥–åŠ±è®¡ç®—

å¥–åŠ±è®¡ç®—å…¬å¼ï¼ˆ`StakingLib.calculateReward`ï¼‰ï¼š

```solidity
// å¹´åŒ–ç‡ = rewardRate (basis points) / 10000
// å®Œæ•´å¹´ä»½å¥–åŠ± = æœ¬é‡‘ Ã— å¹´åŒ–ç‡ Ã— å®Œæ•´å¹´ä»½æ•°
// å‰©ä½™æ—¶é—´å¥–åŠ± = æœ¬é‡‘ Ã— å¹´åŒ–ç‡ Ã— (å‰©ä½™ç§’æ•° / 365å¤©çš„ç§’æ•°)
// æ€»å¥–åŠ± = å®Œæ•´å¹´ä»½å¥–åŠ± + å‰©ä½™æ—¶é—´å¥–åŠ±
```

**è®¡ç®—ç‰¹ç‚¹**ï¼š
- å¥–åŠ±æŒ‰ç§’è¿ç»­ç´¯ç§¯ï¼Œç²¾ç¡®åˆ°ç§’
- å¦‚æœ `timeElapsed > lockPeriod`ï¼Œå¥–åŠ±åªè®¡ç®—åˆ° `lockPeriod` ç»“æŸ
- ä½¿ç”¨ 18 ä½å°æ•°ç²¾åº¦è¿›è¡Œé«˜ç²¾åº¦è®¡ç®—

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### é‡å…¥æ”»å‡»é˜²æŠ¤
- ä½¿ç”¨ OpenZeppelin çš„ `ReentrancyGuardUpgradeable`
- æ‰€æœ‰æ¶‰åŠèµ„é‡‘è½¬ç§»çš„å‡½æ•°éƒ½ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦

### ç´§æ€¥æ¨¡å¼
- ç®¡ç†å‘˜å¯å¯ç”¨ç´§æ€¥æ¨¡å¼
- ç´§æ€¥æ¨¡å¼ä¸‹ï¼š
  - å¥–åŠ±åˆ†é…æš‚åœ
  - ç”¨æˆ·åªèƒ½æå–æœ¬é‡‘ï¼ˆé€šè¿‡ `emergencyWithdraw`ï¼‰
  - æ–°è´¨æŠ¼è¢«é˜»æ­¢
- è¯´æ˜ï¼šè‹¥å·²æ»¡è¶³è§£é”æ¡ä»¶ï¼Œæ­£å¸¸ `unstake` ä»å¯æ‰§è¡Œï¼Œä½†å¥–åŠ±ä¸º 0ï¼›æœªåˆ°æœŸå¯ä½¿ç”¨ `emergencyWithdraw`ï¼ˆä»…æœ¬é‡‘ï¼‰

### æš‚åœæœºåˆ¶
- ç®¡ç†å‘˜å¯æš‚åœåˆçº¦ï¼ˆ`pause()`ï¼‰
- æš‚åœæ—¶ï¼š
  - è´¨æŠ¼åŠŸèƒ½è¢«ç¦ç”¨
  - å¥–åŠ±æå–è¢«ç¦ç”¨
  - è§£é™¤è´¨æŠ¼åŠŸèƒ½ä¸å—å½±å“

### è®¿é—®æ§åˆ¶
- **Owner**: åˆçº¦æ‰€æœ‰è€…ï¼Œè´Ÿè´£æ‰€æœ‰ç®¡ç†åŠŸèƒ½ï¼ˆåŒ…æ‹¬å‡çº§ã€å‚æ•°é…ç½®ç­‰ï¼‰
- ä½¿ç”¨ OpenZeppelin çš„ OwnableUpgradeable æ ‡å‡†å®ç°
- æ”¯æŒæ‰€æœ‰æƒè½¬ç§»ï¼ˆ`transferOwnership`ï¼‰å’Œæ”¾å¼ƒæ‰€æœ‰æƒï¼ˆ`renounceOwnership`ï¼‰

## ğŸ“ éƒ¨ç½²æŒ‡å—

### æ ‡å‡†éƒ¨ç½²ï¼ˆå•äº§å“ï¼‰

#### éƒ¨ç½²åˆ°æµ‹è¯•ç½‘

```bash
npx hardhat run scripts/deploy.ts --network hashkeyTestnet
```

#### éƒ¨ç½²åˆ°ä¸»ç½‘

```bash
npx hardhat run scripts/deploy.ts --network hashkeyMainnet
```

### åŒå±‚äº§å“æ–¹æ¡ˆéƒ¨ç½²

åŸºäºç°æœ‰åˆçº¦æ¶æ„ï¼Œå¯ä»¥éƒ¨ç½²ä¸¤å¥—ç‹¬ç«‹çš„äº§å“æ–¹æ¡ˆï¼š

#### äº§å“æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ™®é€š Stakingï¼ˆå§”æ‰˜è´¨æŠ¼ï¼‰ | Premium Stakingï¼ˆé«˜çº§è´¨æŠ¼ï¼‰ |
|------|----------------------|------------------------|
| ç›®æ ‡ç”¨æˆ· | æ™®é€šç”¨æˆ· | å¤§æˆ·/æœºæ„ |
| æœ€å°è´¨æŠ¼ | 1 HSK | 500,000 HSK |
| å¹´åŒ–æ”¶ç›Š | 8% | 16% |
| ç™½åå•æ¨¡å¼ | å…³é—­ï¼ˆå¼€æ”¾ï¼‰ | å¯ç”¨ï¼ˆéœ€æˆæƒï¼‰ |

#### éƒ¨ç½²æ–¹å¼

**æ–¹å¼ä¸€ï¼šåˆ†åˆ«éƒ¨ç½²**

```bash
# éƒ¨ç½²æ™®é€š Staking
npx hardhat run scripts/deployNormalStaking.ts --network <network>

# éƒ¨ç½² Premium Staking
npx hardhat run scripts/deployPremiumStaking.ts --network <network>
```

**æ–¹å¼äºŒï¼šä¸€æ¬¡æ€§éƒ¨ç½²ä¸¤ä¸ªäº§å“**

```bash
npx hardhat run scripts/deployDualTier.ts --network <network>
```

#### éƒ¨ç½²åé…ç½®

**æ³¨æ„**ï¼šéƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´ä¸ºéƒ¨ç½²å7å¤©ã€‚å¦‚éœ€è°ƒæ•´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š

```bash
# è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´
npx hardhat run scripts/setStakeStartTime.ts --network <network> \
  -- --contract <CONTRACT_ADDRESS> --timestamp <START_TIMESTAMP>
```

å…¶ä»–é…ç½®ï¼š

1. **ä¸º Premium Staking æ·»åŠ ç™½åå•ç”¨æˆ·**ï¼ˆPremium Staking å¯ç”¨äº†ç™½åå•æ¨¡å¼ï¼‰
   ```bash
   npx hardhat run scripts/addToWhitelist.ts --network <network> \
     -- --contract <PREMIUM_STAKING_ADDRESS> --user <USER_ADDRESS>
   ```

2. **å‘å¥–åŠ±æ± å……å€¼**ï¼ˆä¸¤ä¸ªäº§å“éœ€è¦ç‹¬ç«‹çš„å¥–åŠ±æ± ï¼‰
   ```bash
   # æ™®é€š Staking å¥–åŠ±æ± 
   npx hardhat run scripts/add-rewards.ts --network <network> \
     -- --contract <NORMAL_STAKING_ADDRESS> --amount <AMOUNT>
   
   # Premium Staking å¥–åŠ±æ± 
   npx hardhat run scripts/add-rewards.ts --network <network> \
     -- --contract <PREMIUM_STAKING_ADDRESS> --amount <AMOUNT>
   ```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š
- [åŒå±‚äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£
- [æŠ€æœ¯å¸¸è§é—®é¢˜](./docs/TECHNICAL_FAQ.md) - æŠ€æœ¯æœºåˆ¶è¯´æ˜

### éªŒè¯åˆçº¦

```bash
npx hardhat run scripts/verify.ts --network hashkeyTestnet
```

### å‡çº§åˆçº¦

```bash
npx hardhat run scripts/upgrade.ts --network hashkeyTestnet
```

## ğŸ”§ è„šæœ¬è¯´æ˜

### å¸¸ç”¨è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `deploy.ts` | éƒ¨ç½²åˆçº¦ï¼ˆæ ‡å‡†éƒ¨ç½²ï¼‰ |
| `deployNormalStaking.ts` | éƒ¨ç½²æ™®é€š Staking äº§å“ |
| `deployPremiumStaking.ts` | éƒ¨ç½² Premium Staking äº§å“ |
| `deployDualTier.ts` | ä¸€æ¬¡æ€§éƒ¨ç½²åŒå±‚äº§å“æ–¹æ¡ˆ |
| `stake.ts` | æ‰§è¡Œè´¨æŠ¼ |
| `upgrade.ts` | å‡çº§åˆçº¦ |
| `addToWhitelist.ts` | æ·»åŠ ç™½åå• |
| `addToWhitelistBatch.ts` | æ‰¹é‡æ·»åŠ ç™½åå• |
| `checkStakes.ts` | æŸ¥è¯¢ç”¨æˆ·è´¨æŠ¼æƒ…å†µ |
| `checkWhitelist.ts` | æ£€æŸ¥ç™½åå•çŠ¶æ€ |
| `setMaxStake.ts` | è®¾ç½®æœ€å¤§è´¨æŠ¼é‡ |
| `setStakeStartTime.ts` | è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´ |
| `setStakeEndTime.ts` | è®¾ç½®è´¨æŠ¼æˆªæ­¢æ—¶é—´ |
| `add-rewards.ts` | å‘å¥–åŠ±æ± å……å€¼ |

### åˆ†æè„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `analyzeStaking.ts` | åˆ†æè´¨æŠ¼æ¡ˆä¾‹ |
| `analyzeAPY.ts` | åˆ†æ APY è®¡ç®— |
| `checkLockPeriods.ts` | æŸ¥è¯¢é”å®šæœŸé€‰é¡¹ |

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š

```bash
npx hardhat test
```

è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶ï¼š

```bash
npx hardhat test test/staking.test.js
```

ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼š

```bash
npx hardhat coverage
```

## ğŸ“Š ç½‘ç»œé…ç½®

### HashKey æµ‹è¯•ç½‘
- **Chain ID**: 133
- **RPC URL**: https://hashkeychain-testnet.alt.technology
- **Explorer**: https://hashkeychain-testnet-explorer.alt.technology

### HashKey ä¸»ç½‘
- **Chain ID**: 177
- **RPC URL**: https://mainnet.hsk.xyz
- **Explorer**: https://explorer.hsk.xyz

## ğŸ“š æŠ€æœ¯æ ˆ

- **Solidity**: ^0.8.27
- **Hardhat**: ^2.22.17
- **OpenZeppelin Contracts Upgradeable**: ^5.4.0
- **TypeScript**: ^5.7.3
- **ä»£ç†æ¨¡å¼**: Transparent Proxy

## ğŸ” åˆçº¦ç‰ˆæœ¬

- **Layer2Staking V1.0.0** (`staking.sol`) - åˆå§‹ç‰ˆæœ¬
  - æ”¯æŒå¤šä¸ªé”å®šæœŸé€‰é¡¹
  - æ”¯æŒ `updateLockOption` ä¿®æ”¹é”å®šæœŸ
  - å‡çº§å†·å´æœŸï¼š7å¤©
  
- **Layer2StakingV2 V2.0.0** (`Layer2StakingV2.sol`) - å½“å‰ç‰ˆæœ¬
  - **å›ºå®š365å¤©é”å®šæœŸ**ï¼Œç®€åŒ–ç”¨æˆ·æ“ä½œ
  - **ç§»é™¤å¤šé”å®šæœŸé€‰é¡¹**ï¼Œé€šè¿‡ä¸åŒäº§å“ï¼ˆæ™®é€š/Premiumï¼‰æä¾›ä¸åŒæ”¶ç›Šç‡
  - **ç§»é™¤ TIME_TOLERANCE**ï¼Œä¸¥æ ¼æ‰§è¡Œé”å®šæœŸ
  - **ä¼˜åŒ–çš„ stake() æ¥å£**ï¼šæ— éœ€ä¼ å…¥ lockPeriod å‚æ•°
  - **ä½¿ç”¨ Transparent Proxy**ï¼šæ›¿ä»£ UUPSï¼Œå‡çº§ç”± ProxyAdmin æ§åˆ¶
  - **ç®€åŒ–è®¿é—®æ§åˆ¶**ï¼šä½¿ç”¨ OpenZeppelin Ownableï¼Œç§»é™¤è‡ªå®šä¹‰ admin æœºåˆ¶
  - **ä¼˜åŒ–æ¥å£**ï¼šç§»é™¤å†—ä½™æ–¹æ³•ï¼ˆgetUserPositionsã€setWhitelist ç­‰ï¼‰
  - **å¥–åŠ±æ± æ£€æŸ¥é€»è¾‘ä¼˜åŒ–**

## âš ï¸ é‡è¦æé†’

1. **è´¨æŠ¼æ—¶é—´çª—å£**ï¼šåˆçº¦æ”¯æŒè®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚éƒ¨ç½²è„šæœ¬é»˜è®¤è®¾ç½®å¼€å§‹æ—¶é—´ä¸ºéƒ¨ç½²å7å¤©ï¼Œç»“æŸæ—¶é—´æ— é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ `setStakeStartTime` å’Œ `setStakeEndTime` å‡½æ•°è°ƒæ•´
2. **å¥–åŠ±è®¡ç®—é™åˆ¶**ï¼šå¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸï¼Œå¤šè´¨æŠ¼çš„æ—¶é—´ä¸ä¼šå¢åŠ å¥–åŠ±
3. **ç™½åå•æ¨¡å¼**ï¼šåˆçº¦æ”¯æŒç™½åå•æ¨¡å¼ï¼Œå¯åœ¨éƒ¨ç½²æ—¶é…ç½®ã€‚åŒå±‚äº§å“æ–¹æ¡ˆä¸­ï¼Œæ™®é€š Staking å…³é—­ç™½åå•ï¼ˆå¼€æ”¾ï¼‰ï¼ŒPremium Staking å¯ç”¨ç™½åå•ï¼ˆéœ€å®¡æ ¸ï¼‰
4. **æœ€å°è´¨æŠ¼é‡‘é¢**ï¼šåˆçº¦é»˜è®¤æœ€å°è´¨æŠ¼é‡‘é¢ä¸º 100 HSKï¼Œä½†äº§å“éƒ¨ç½²æ—¶å¯é…ç½®ï¼ˆæ™®é€š Staking äº§å“é…ç½®ä¸º 1 HSKï¼‰
5. **æœ€å¤§è´¨æŠ¼é‡**ï¼šåˆçº¦é»˜è®¤æœ€å¤§æ€»è´¨æŠ¼é‡ä¸º 10,000 HSKï¼Œä½†äº§å“éƒ¨ç½²æ—¶å¯é…ç½®ï¼ˆæ™®é€š Staking äº§å“é…ç½®ä¸º 10,000,000 HSKï¼‰
6. **å¥–åŠ±æ± **ï¼šç¡®ä¿å¥–åŠ±æ± æœ‰è¶³å¤Ÿèµ„é‡‘ï¼Œå¦åˆ™æ–°è´¨æŠ¼å¯èƒ½å¤±è´¥

### åŒå±‚äº§å“æ–¹æ¡ˆé…ç½®

åŸºäºç°æœ‰åˆçº¦ï¼Œå¯ä»¥éƒ¨ç½²ä¸¤å¥—ç‹¬ç«‹çš„äº§å“æ–¹æ¡ˆï¼š

- **æ™®é€š Stakingï¼ˆå§”æ‰˜è´¨æŠ¼ï¼‰**ï¼š
  - æœ€å°è´¨æŠ¼ï¼š1 HSK
  - å¹´åŒ–æ”¶ç›Šï¼š8%
  - é”å®šæœŸï¼š365å¤©
  - ç™½åå•ï¼šå…³é—­ï¼ˆå¼€æ”¾ï¼‰
  - æœ€å¤§æ€»è´¨æŠ¼é‡ï¼š10,000,000 HSK

- **Premium Stakingï¼ˆé«˜çº§è´¨æŠ¼ï¼‰**ï¼š
  - æœ€å°è´¨æŠ¼ï¼š500,000 HSK
  - å¹´åŒ–æ”¶ç›Šï¼š16%
  - é”å®šæœŸï¼š365å¤©
  - ç™½åå•ï¼šå¯ç”¨ï¼ˆéœ€å®¡æ ¸ï¼‰
  - æœ€å¤§æ€»è´¨æŠ¼é‡ï¼š20,000,000 HSK

è¯¦ç»†äº§å“æ–¹æ¡ˆè¯·å‚è€ƒï¼š
- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£
- [åŒå±‚äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“å¼€å‘æ–‡æ¡£](./docs/PRODUCT_PLANS_DEV.md) - å¼€å‘å›¢é˜Ÿæ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

MIT License


---

**æ³¨æ„**ï¼šæœ¬åˆçº¦å·²é€šè¿‡å®‰å…¨å®¡è®¡ï¼Œä½†åœ¨ä¸»ç½‘éƒ¨ç½²å‰è¯·åŠ¡å¿…è¿›è¡Œå……åˆ†æµ‹è¯•ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£äº§å“æ–¹æ¡ˆ
- [åŒå±‚äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“å¼€å‘æ–‡æ¡£](./docs/PRODUCT_PLANS_DEV.md) - å¼€å‘å›¢é˜Ÿæ–‡æ¡£
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./docs/QUICK_START_DUAL_TIER.md) - å¿«é€Ÿéƒ¨ç½²æŒ‡å—
- [æŠ€æœ¯å¸¸è§é—®é¢˜](./docs/TECHNICAL_FAQ.md) - æŠ€æœ¯æœºåˆ¶è¯´æ˜
- [æœ¯è¯­è¡¨](./docs/GLOSSARY.md) - æœ¯è¯­å®šä¹‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.1.0  
**æœ€åæ›´æ–°**: 2026-11  
**ç»´æŠ¤è€…**: Whale Staking Team
