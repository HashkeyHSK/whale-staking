# Whale Staking Contract

ä¸€ä¸ªåŸºäº HashKey Layer2 ç½‘ç»œçš„å»ä¸­å¿ƒåŒ–è´¨æŠ¼åˆçº¦ï¼Œæ”¯æŒå¤šé”å®šæœŸé€‰é¡¹ã€ç™½åå•æœºåˆ¶å’Œå¯å‡çº§ä»£ç†æ¨¡å¼ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [åˆçº¦æ¶æ„](#åˆçº¦æ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åˆçº¦æ¥å£](#åˆçº¦æ¥å£)
- [é”å®šæœŸé€‰é¡¹](#é”å®šæœŸé€‰é¡¹)
- [å¥–åŠ±è®¡ç®—](#å¥–åŠ±è®¡ç®—)
- [å®‰å…¨ç‰¹æ€§](#å®‰å…¨ç‰¹æ€§)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [è„šæœ¬è¯´æ˜](#è„šæœ¬è¯´æ˜)
- [æµ‹è¯•](#æµ‹è¯•)
- [è®¸å¯è¯](#è®¸å¯è¯)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å›ºå®šé”å®šæœŸ**ï¼šå›ºå®š365å¤©é”å®šæœŸï¼Œç®€åŒ–ç”¨æˆ·é€‰æ‹©ï¼Œç»Ÿä¸€ç®¡ç†
- **å¯å‡çº§ä»£ç†**ï¼šé‡‡ç”¨ Transparent Proxy ä»£ç†æ¨¡å¼ï¼Œæ”¯æŒåˆçº¦å‡çº§
- **ç™½åå•æœºåˆ¶**ï¼šæ”¯æŒç™½åå•æ¨¡å¼ï¼Œå¯é™åˆ¶åªæœ‰ç™½åå•ç”¨æˆ·æ‰èƒ½è´¨æŠ¼
- **è´¨æŠ¼æ—¶é—´æ§åˆ¶**ï¼šæ”¯æŒè®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œçµæ´»æ§åˆ¶è´¨æŠ¼æ—¶é—´çª—å£
- **å¥–åŠ±æ± ç®¡ç†**ï¼šç‹¬ç«‹çš„å¥–åŠ±æ± ç³»ç»Ÿï¼Œç¡®ä¿å¥–åŠ±åˆ†é…çš„å®‰å…¨æ€§
- **å›ºå®šæ”¶ç›Šç‡**ï¼šéƒ¨ç½²æ—¶é…ç½®å›ºå®šå¹´åŒ–æ”¶ç›Šç‡ï¼ˆ5% æˆ– 16%ï¼‰ï¼Œæ¸…æ™°æ˜ç¡®

### å®‰å…¨ç‰¹æ€§
- **é‡å…¥æ”»å‡»é˜²æŠ¤**ï¼šä½¿ç”¨ OpenZeppelin çš„ ReentrancyGuard
- **ç´§æ€¥æ¨¡å¼**ï¼šæ”¯æŒç´§æ€¥æš‚åœå’Œç´§æ€¥æå–ï¼ˆä»…æå–æœ¬é‡‘ï¼‰
- **æš‚åœæœºåˆ¶**ï¼šæ‰€æœ‰è€…å¯æš‚åœåˆçº¦åŠŸèƒ½
- **è®¿é—®æ§åˆ¶**ï¼šåŸºäº OpenZeppelin Ownable çš„æ‰€æœ‰æƒç®¡ç†

## ğŸ—ï¸ åˆçº¦æ¶æ„

### åˆçº¦æ–‡ä»¶ç»“æ„

```
contracts/
â”œâ”€â”€ implementation/          # å®ç°åˆçº¦ç›®å½•
â”‚   â”œâ”€â”€ HSKStaking.sol      # ä¸»å®ç°åˆçº¦ï¼ˆæ ¸å¿ƒè´¨æŠ¼é€»è¾‘ï¼‰
â”‚   â””â”€â”€ StakingStorage.sol  # å­˜å‚¨å±‚åˆçº¦ï¼ˆå®šä¹‰æ‰€æœ‰çŠ¶æ€å˜é‡ï¼‰
â”œâ”€â”€ constants/               # å¸¸é‡å®šä¹‰ç›®å½•
â”‚   â””â”€â”€ StakingConstants.sol # è´¨æŠ¼å¸¸é‡ï¼ˆé”å®šæœŸã€ç²¾åº¦ç­‰ï¼‰
â”œâ”€â”€ interfaces/              # æ¥å£å®šä¹‰ç›®å½•
â”‚   â””â”€â”€ IStake.sol          # è´¨æŠ¼æ¥å£å®šä¹‰
â”œâ”€â”€ StakingProxy.sol   # è´¨æŠ¼ä»£ç†åˆçº¦ï¼ˆ1000 HSK, 5% APYï¼‰
â””â”€â”€ .sol  # ï¼ˆ500K HSK, 16% APYï¼‰
```

### åˆçº¦ç»§æ‰¿å…³ç³»

```
HSKStaking (ä¸»å®ç°åˆçº¦)
â”œâ”€â”€ IStaking (æ¥å£å®šä¹‰)
â”œâ”€â”€ StakingStorage (å­˜å‚¨å±‚)
â”‚   â”œâ”€â”€ Initializable (åˆå§‹åŒ–æ§åˆ¶)
â”‚   â””â”€â”€ Ownable2StepUpgradeable (ä¸€æ­¥æ‰€æœ‰æƒç®¡ç†)
â”œâ”€â”€ StakingConstants (å¸¸é‡å®šä¹‰)
â”œâ”€â”€ ReentrancyGuardUpgradeable (é‡å…¥ä¿æŠ¤)
â””â”€â”€ PausableUpgradeable (æš‚åœåŠŸèƒ½)

ä»£ç†åˆçº¦æ¶æ„
â””â”€â”€ StakingProxy (TransparentUpgradeableProxy)
    â”œâ”€â”€ æŒ‡å‘ HSKStaking å®ç°
    â”œâ”€â”€ æœ€å°è´¨æŠ¼ï¼š1000 HSK
    â””â”€â”€ å¹´åŒ–æ”¶ç›Šï¼š5% (500 basis points)
    â”œâ”€â”€ æŒ‡å‘ HSKStaking å®ç°
    â”œâ”€â”€ æœ€å°è´¨æŠ¼ï¼š500,000 HSK
    â””â”€â”€ å¹´åŒ–æ”¶ç›Šï¼š16% (1600 basis points)
```

**æ¶æ„è¯´æ˜**ï¼š
- å•ä¸ªä»£ç†åˆçº¦å…±äº«åŒä¸€ä¸ª HSKStaking å®ç°åˆçº¦
- é€šè¿‡ `initialize()` å‡½æ•°çš„ä¸åŒå‚æ•°é…ç½®ä¸åŒçš„äº§å“ç‰¹æ€§
- å›ºå®šé”å®šæœŸ 365 å¤©ç”± `StakingConstants.LOCK_PERIOD` å®šä¹‰
- å¹´åŒ–æ”¶ç›Šç‡åœ¨éƒ¨ç½²æ—¶é€šè¿‡ `rewardRate` å‚æ•°è®¾ç½®ï¼ˆbasis points: 100% = 10000ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- npm, yarn æˆ– pnpm

### å®‰è£…ä¾èµ–

```bash
npm install
# æˆ–
yarn install
# æˆ–
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
PRIVATE_KEY=your_private_key_here
```

### ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

### è¿è¡Œæµ‹è¯•

```bash
npx hardhat test
```

## ğŸ“– åˆçº¦æ¥å£

### ç”¨æˆ·åŠŸèƒ½

#### `stake() payable â†’ uint256 positionId`
åˆ›å»ºæ–°çš„è´¨æŠ¼ä½ç½®ï¼ˆå›ºå®š365å¤©é”å®šæœŸï¼‰
- **å‚æ•°**: æ— å‚æ•°ï¼Œé€šè¿‡ `msg.value` å‘é€è´¨æŠ¼é‡‘é¢ï¼Œé”å®šæœŸå›ºå®šä¸º365å¤©
- **è¿”å›**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¦æ±‚**: 
  - å½“å‰æ—¶é—´å¿…é¡»åœ¨è´¨æŠ¼æ—¶é—´çª—å£å†…ï¼ˆ`block.timestamp >= stakeStartTime && block.timestamp < stakeEndTime`ï¼‰
  - å¦‚æœå¯ç”¨ç™½åå•æ¨¡å¼ï¼Œå¿…é¡»æ˜¯ç™½åå•ç”¨æˆ·ï¼ˆé€šè¿‡ `whitelistCheck` ä¿®é¥°ç¬¦æ£€æŸ¥ï¼‰
  - è´¨æŠ¼é‡‘é¢ >= æœ€å°è´¨æŠ¼é‡‘é¢ï¼ˆ`minStakeAmount`ï¼‰
  - å¦‚æœè®¾ç½®äº†æœ€å¤§æ€»è´¨æŠ¼é‡ï¼Œæ€»è´¨æŠ¼é‡ + å½“å‰è´¨æŠ¼é‡‘é¢ <= æœ€å¤§æ€»è´¨æŠ¼é‡
  - å¥–åŠ±æ± ä½™é¢å……è¶³ï¼ˆ`rewardPoolBalance >= actualAccruedRewards + potentialReward`ï¼‰
  - åˆçº¦æœªæš‚åœï¼ˆ`whenNotPaused`ï¼‰
  - éç´§æ€¥æ¨¡å¼ï¼ˆ`whenNotEmergency`ï¼‰
- **äº‹ä»¶**: è§¦å‘ `PositionCreated` äº‹ä»¶

#### `unstake(uint256 positionId)`
è§£é™¤è´¨æŠ¼å¹¶æå–æœ¬é‡‘å’Œå¥–åŠ±
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: è‡ªåŠ¨è½¬è´¦æœ¬é‡‘å’Œå¥–åŠ±åˆ°è°ƒç”¨è€…åœ°å€
- **è¦æ±‚**: 
  - å¿…é¡»æ˜¯ä½ç½®æ‰€æœ‰è€…ï¼ˆé€šè¿‡ `validPosition` ä¿®é¥°ç¬¦æ£€æŸ¥ï¼‰
  - é”å®šæœŸå·²ç»“æŸï¼ˆ`block.timestamp >= position.stakedAt + LOCK_PERIOD`ï¼Œå³365å¤©ï¼‰
  - ä½ç½®æœªè§£é™¤è´¨æŠ¼ï¼ˆ`!position.isUnstaked`ï¼‰
- **æå–é‡‘é¢**: æœ¬é‡‘ + å…¨éƒ¨ç´¯ç§¯å¥–åŠ±
- **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦é˜²æ­¢é‡å…¥æ”»å‡»

#### `claimReward(uint256 positionId) â†’ uint256 reward`
æå–å¥–åŠ±ï¼ˆä¸è§£é™¤è´¨æŠ¼ï¼‰
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: `reward` - æå–çš„å¥–åŠ±é‡‘é¢
- **è¦æ±‚**: 
  - å¿…é¡»æ˜¯ä½ç½®æ‰€æœ‰è€…ï¼ˆé€šè¿‡ `validPosition` ä¿®é¥°ç¬¦æ£€æŸ¥ï¼‰
  - å¿…é¡»æœ‰æœªæå–çš„å¥–åŠ±ï¼ˆ`reward > 0`ï¼‰
  - åˆçº¦æœªæš‚åœï¼ˆ`whenNotPaused`ï¼‰
  - éç´§æ€¥æ¨¡å¼ï¼ˆ`whenNotEmergency`ï¼‰
- **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦é˜²æ­¢é‡å…¥æ”»å‡»

#### `pendingReward(uint256 positionId) view â†’ uint256 reward`
æŸ¥è¯¢å¾…æå–å¥–åŠ±
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¿”å›**: `reward` - å¾…æå–å¥–åŠ±é‡‘é¢
- **è¯´æ˜**: 
  - ç´§æ€¥æ¨¡å¼ä¸‹è¿”å› 0
  - åªèƒ½æŸ¥è¯¢è‡ªå·±çš„è´¨æŠ¼ä½ç½®
  - å¥–åŠ±æŒ‰ç§’è¿ç»­ç´¯ç§¯ï¼Œç²¾ç¡®åˆ°ç§’

#### `getUserPositionIds(address user) view â†’ uint256[] memory`
è·å–ç”¨æˆ·çš„æ‰€æœ‰è´¨æŠ¼ä½ç½®ID
- **å‚æ•°**: `user` - ç”¨æˆ·åœ°å€
- **è¿”å›**: `uint256[]` - è¯¥ç”¨æˆ·çš„æ‰€æœ‰ positionId æ•°ç»„
- **è¯´æ˜**: 
  - ä¸€æ¬¡è°ƒç”¨å³å¯è·å–æ‰€æœ‰ID
  - æ•ˆç‡æœ€é«˜

#### `calculatePotentialReward(uint256 amount) view â†’ uint256`
è®¡ç®—æŒ‡å®šé‡‘é¢çš„æ½œåœ¨å¥–åŠ±
- **å‚æ•°**: `amount` - è´¨æŠ¼é‡‘é¢ï¼ˆweiï¼‰
- **è¿”å›**: `uint256` - 365å¤©é”å®šæœŸæ»¡åçš„æ½œåœ¨å¥–åŠ±é‡‘é¢
- **è¯´æ˜**: 
  - ç”¨äºè´¨æŠ¼å‰é¢„è§ˆå¥–åŠ±
  - åŸºäºå½“å‰å¥–åŠ±ç‡è®¡ç®—

### ç®¡ç†å‘˜åŠŸèƒ½

#### `updateWhitelistBatch(address[] calldata users, bool status)`
æ‰¹é‡æ›´æ–°ç™½åå•
- **å‚æ•°**: 
  - `users` - ç”¨æˆ·åœ°å€æ•°ç»„ï¼ˆæœ€å¤š100ä¸ªï¼‰
  - `status` - true æ·»åŠ åˆ°ç™½åå•ï¼Œfalse ä»ç™½åå•ç§»é™¤
- **è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
- **äº‹ä»¶**: ä¸ºæ¯ä¸ªçŠ¶æ€å˜æ›´çš„ç”¨æˆ·è§¦å‘ `WhitelistStatusChanged` äº‹ä»¶

#### `setWhitelistOnlyMode(bool enabled)`
å¯ç”¨/ç¦ç”¨ç™½åå•æ¨¡å¼
- **å‚æ•°**: `enabled` - true å¯ç”¨ç™½åå•æ¨¡å¼ï¼Œfalse ç¦ç”¨
- **è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
- **äº‹ä»¶**: è§¦å‘ `WhitelistModeChanged` äº‹ä»¶

#### `setStakeStartTime(uint256 newStartTime)`
è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´
- **å‚æ•°**: `newStartTime` - è´¨æŠ¼å¼€å§‹æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
- **è¦æ±‚**: 
  - ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
  - `newStartTime > 0` - å¿…é¡»æ˜¯æœ‰æ•ˆæ—¶é—´
  - `newStartTime < stakeEndTime` - å¿…é¡»æ—©äºç»“æŸæ—¶é—´
- **è¯´æ˜**: ç”¨æˆ·åªèƒ½åœ¨ `stakeStartTime` ä¹‹åå¼€å§‹è´¨æŠ¼
- **äº‹ä»¶**: è§¦å‘ `StakeStartTimeUpdated` äº‹ä»¶

#### `setStakeEndTime(uint256 newEndTime)`
è®¾ç½®è´¨æŠ¼æˆªæ­¢æ—¶é—´
- **å‚æ•°**: `newEndTime` - è´¨æŠ¼ç»“æŸæ—¶é—´æˆ³ï¼ˆç§’ï¼‰
- **è¦æ±‚**: 
  - ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
  - `newEndTime > block.timestamp` - å¿…é¡»æ˜¯æœªæ¥çš„æ—¶é—´
  - `newEndTime > stakeStartTime` - å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´
- **è¯´æ˜**: ç”¨æˆ·åªèƒ½åœ¨ `stakeEndTime` ä¹‹å‰è´¨æŠ¼
- **äº‹ä»¶**: è§¦å‘ `StakeEndTimeUpdated` äº‹ä»¶

#### `setMinStakeAmount(uint256 newAmount)`
è®¾ç½®æœ€å°è´¨æŠ¼é‡‘é¢
- **å‚æ•°**: `newAmount` - æ–°çš„æœ€å°è´¨æŠ¼é‡‘é¢ï¼ˆweiï¼‰
- **è¦æ±‚**: 
  - ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
  - éç´§æ€¥æ¨¡å¼ï¼ˆ`whenNotEmergency`ï¼‰
- **äº‹ä»¶**: è§¦å‘ `MinStakeAmountUpdated` äº‹ä»¶

#### `setMaxTotalStaked(uint256 newAmount)`
è®¾ç½®æœ€å¤§æ€»è´¨æŠ¼é‡
- **å‚æ•°**: `newAmount` - æ–°çš„æœ€å¤§æ€»è´¨æŠ¼é‡ï¼ˆweiï¼Œ0 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
- **è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
- **äº‹ä»¶**: è§¦å‘ `MaxTotalStakedUpdated` äº‹ä»¶
- **è¯´æ˜**: è®¾ç½®æ•´ä¸ªäº§å“æ± çš„ä¸Šé™ï¼Œæ‰€æœ‰ç”¨æˆ·è´¨æŠ¼é‡‘é¢æ€»å’Œä¸èƒ½è¶…è¿‡æ­¤é™åˆ¶

#### `updateRewardPool() payable`
å‘å¥–åŠ±æ± å……å€¼
- **å‚æ•°**: é€šè¿‡ `msg.value` å‘é€å……å€¼é‡‘é¢
- **è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
- **æ•ˆæœ**: å¢åŠ  `rewardPoolBalance`
- **äº‹ä»¶**: è§¦å‘ `RewardPoolUpdated` äº‹ä»¶

#### `withdrawExcessRewardPool(uint256 amount)`
æå–å¥–åŠ±æ± å¤šä½™èµ„é‡‘
- **å‚æ•°**: `amount` - æå–é‡‘é¢
- **è¦æ±‚**: 
  - ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
  - `rewardPoolBalance >= totalPendingRewards` - å¥–åŠ±æ± ä½™é¢å……è¶³
  - `amount <= excess` - ä¸èƒ½æå–å·²åˆ†é…çš„å¥–åŠ±
- **æ•ˆæœ**: å‡å°‘ `rewardPoolBalance`ï¼Œè½¬è´¦åˆ° owner
- **äº‹ä»¶**: è§¦å‘ `RewardPoolUpdated` äº‹ä»¶

#### `enableEmergencyMode()`
å¯ç”¨ç´§æ€¥æ¨¡å¼ï¼ˆæš‚åœå¥–åŠ±åˆ†é…ï¼‰
- **è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯è°ƒç”¨ï¼ˆ`onlyOwner`ï¼‰
- **æ•ˆæœ**: 
  - è®¾ç½® `emergencyMode = true`
  - æš‚åœå¥–åŠ±åˆ†é…ï¼ˆæ‰€æœ‰å¥–åŠ±ç›¸å…³å‡½æ•°è¿”å›0ï¼‰
  - é˜»æ­¢æ–°è´¨æŠ¼
  - å…è®¸ç´§æ€¥æå–ï¼ˆä»…æœ¬é‡‘ï¼‰
- **äº‹ä»¶**: è§¦å‘ `EmergencyModeEnabled` äº‹ä»¶
- **æ³¨æ„**: å½“å‰ç‰ˆæœ¬ç´§æ€¥æ¨¡å¼ä¸€æ—¦å¯ç”¨æ— æ³•é€šè¿‡å‡½æ•°å…³é—­ï¼Œå¯èƒ½éœ€è¦åˆçº¦å‡çº§

#### `emergencyWithdraw(uint256 positionId)`
ç´§æ€¥æå–ï¼ˆä»…æå–æœ¬é‡‘ï¼Œä¸åŒ…å«å¥–åŠ±ï¼‰
- **å‚æ•°**: `positionId` - è´¨æŠ¼ä½ç½® ID
- **è¦æ±‚**: 
  - å¿…é¡»åœ¨ç´§æ€¥æ¨¡å¼ä¸‹ï¼ˆ`emergencyMode == true`ï¼‰
  - å¿…é¡»æ˜¯ä½ç½®æ‰€æœ‰è€…ï¼ˆ`position.owner == msg.sender`ï¼‰
  - ä½ç½®æœªè§£é™¤è´¨æŠ¼ï¼ˆ`!position.isUnstaked`ï¼‰
  - **ä¸å—é”å®šæœŸé™åˆ¶**ï¼ˆå¯ä»¥éšæ—¶æå–ï¼‰
- **æå–é‡‘é¢**: ä»…æœ¬é‡‘ï¼Œ**ä¸åŒ…å«å¥–åŠ±**
- **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦é˜²æ­¢é‡å…¥æ”»å‡»
- **äº‹ä»¶**: è§¦å‘ `EmergencyWithdrawn` äº‹ä»¶

## ğŸ”’ é”å®šæœŸå’Œæ”¶ç›Šç‡

### å›ºå®šé”å®šæœŸ

HSKStaking é‡‡ç”¨å›ºå®šé”å®šæœŸè®¾è®¡ï¼š

| å‚æ•° | é…ç½® | è¯´æ˜ |
|------|------|------|
| é”å®šæœŸ | 365 å¤© | å›ºå®šï¼Œä¸å¯ä¿®æ”¹ |
| æ”¶ç›Šç‡ | 5% | éƒ¨ç½²æ—¶é…ç½® |

### å¥–åŠ±è®¡ç®—è¯´æ˜

**é‡è¦æœºåˆ¶**ï¼š
- å¥–åŠ±æŒ‰ç§’è¿ç»­ç´¯ç§¯ï¼Œç²¾ç¡®åˆ°ç§’ï¼Œå¯éšæ—¶æå–
- å¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸï¼Œå³ä½¿å®é™…è´¨æŠ¼æ—¶é—´æ›´é•¿

ä¾‹å¦‚ï¼š
- å›ºå®š 365 å¤©é”å®šæœŸï¼ˆ5% APYï¼‰
- å®é™…è´¨æŠ¼ 400 å¤©æ‰æå–
- **é‡è¦**ï¼šè¶…è¿‡é”å®šæœŸçš„æ—¶é—´ä¸ä¼šäº§ç”Ÿé¢å¤–å¥–åŠ±ï¼Œå¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸ

### è®¾è®¡ç†å¿µ

V2 ç‰ˆæœ¬ç®€åŒ–äº†é”å®šæœŸé€‰æ‹©ï¼š
- **ç”¨æˆ·å‹å¥½**ï¼šæ— éœ€é€‰æ‹©é”å®šæœŸï¼Œç®€åŒ–æ“ä½œæµç¨‹
- **ç»Ÿä¸€ç®¡ç†**ï¼šå›ºå®š365å¤©ï¼Œä¾¿äºè¿è¥å’Œç”¨æˆ·ç†è§£
- **æ¸…æ™°æ˜ç¡®**ï¼šå•ä¸€äº§å“ï¼Œç»Ÿä¸€æ”¶ç›Šç‡

## ğŸ”“ Unstake æœºåˆ¶è¯´æ˜

### æ­£å¸¸ Unstakeï¼ˆè§£é™¤è´¨æŠ¼ï¼‰

**æ—¶é—´é™åˆ¶**ï¼š
- å¿…é¡»ç­‰å¾…é”å®šæœŸå®Œå…¨ç»“æŸï¼ˆ365å¤©ï¼‰
- è§£é”æ¡ä»¶ï¼š`block.timestamp >= stakedAt + 365 days`

**æå–é‡‘é¢**ï¼š
- âœ… æœ¬é‡‘ + å…¨éƒ¨ç´¯ç§¯å¥–åŠ±
- å¥–åŠ±æŒ‰å®é™…è´¨æŠ¼æ—¶é—´è®¡ç®—ï¼ˆä½†ä¸è¶…è¿‡é”å®šæœŸï¼‰

**ç¤ºä¾‹**ï¼š
```
è´¨æŠ¼æ—¶é—´ï¼š2026-11-01 00:00:00
é”å®šæœŸï¼š365 å¤©
è§£é”æ—¶é—´ï¼š2027-11-01 00:00:00

å¯ä»¥æå–ï¼š2027-11-01 00:00:00 ä¹‹å
æå–é‡‘é¢ï¼šæœ¬é‡‘ + 365å¤©å†…çš„å¥–åŠ±
```

### ç´§æ€¥æå–ï¼ˆEmergency Withdrawï¼‰

**è§¦å‘æ¡ä»¶**ï¼š
- ç®¡ç†å‘˜å¿…é¡»å¯ç”¨ç´§æ€¥æ¨¡å¼ï¼ˆ`enableEmergencyMode()`ï¼‰
- ä¸å—é”å®šæœŸé™åˆ¶ï¼Œå¯ä»¥éšæ—¶æå–

**æå–é‡‘é¢**ï¼š
- âœ… ä»…æœ¬é‡‘
- âŒ ä¸åŒ…å«å¥–åŠ±

**ä½¿ç”¨åœºæ™¯**ï¼š
- åˆçº¦å‡ºç°ç´§æ€¥æƒ…å†µ
- éœ€è¦å¿«é€Ÿå›æ”¶èµ„é‡‘
- æ”¾å¼ƒå¥–åŠ±æ¢å–æå‰é€€å‡º

### æ€»ç»“å¯¹æ¯”

| æå–æ–¹å¼ | æ—¶é—´é™åˆ¶ | å¯æå–é‡‘é¢ | é€‚ç”¨åœºæ™¯ |
|---------|---------|-----------|---------|
| æ­£å¸¸ unstake | é”å®šæœŸç»“æŸï¼ˆ365å¤©ï¼‰ | æœ¬é‡‘ + å¥–åŠ± | æ­£å¸¸æƒ…å†µ |
| ç´§æ€¥æå– | æ— é™åˆ¶ï¼ˆéœ€ç´§æ€¥æ¨¡å¼ï¼‰ | ä»…æœ¬é‡‘ | ç´§æ€¥æƒ…å†µ |

### æ³¨æ„äº‹é¡¹

1. **ä¸¥æ ¼é”å®š**ï¼šå¿…é¡»ç­‰å¾…å®Œæ•´çš„365å¤©é”å®šæœŸï¼Œä¸æ”¯æŒæå‰æå–
2. **é”å®šæœŸå†…å¯æå–å¥–åŠ±**ï¼šè™½ç„¶ä¸èƒ½è§£é™¤è´¨æŠ¼ï¼Œä½†å¯ä»¥éšæ—¶æå–å·²ç´¯ç§¯çš„å¥–åŠ±
3. **ç´§æ€¥æ¨¡å¼**ï¼šåªæœ‰åœ¨ç®¡ç†å‘˜å¯ç”¨ç´§æ€¥æ¨¡å¼åæ‰èƒ½ä½¿ç”¨ç´§æ€¥æå–åŠŸèƒ½

## ğŸ’° å¥–åŠ±è®¡ç®—

å¥–åŠ±è®¡ç®—å…¬å¼ï¼ˆ`HSKStaking._calculateReward`ï¼‰ï¼š

```solidity
// å¹´åŒ–ç‡ = rewardRate (basis points) / 10000
// æ—¶é—´æ¯”ç‡ = timeElapsed / 365 days
// å¥–åŠ± = æœ¬é‡‘ Ã— (å¹´åŒ–ç‡ / 10000) Ã— (timeElapsed / 365 days)
//
// ç®€åŒ–å…¬å¼ï¼š
// reward = (amount Ã— rewardRate Ã— timeElapsed) / (10000 Ã— 365 days)
```

**å®ç°ç»†èŠ‚**ï¼š
```solidity
uint256 annualRate = (rewardRate Ã— PRECISION) / BASIS_POINTS;
uint256 timeRatio = (timeElapsed Ã— PRECISION) / SECONDS_PER_YEAR;
uint256 totalReward = (amount Ã— annualRate Ã— timeRatio) / (PRECISION Ã— PRECISION);
```

**è®¡ç®—ç‰¹ç‚¹**ï¼š
- å¥–åŠ±æŒ‰ç§’è¿ç»­ç´¯ç§¯ï¼Œç²¾ç¡®åˆ°ç§’
- å¦‚æœ `timeElapsed > LOCK_PERIOD`ï¼Œå¥–åŠ±åªè®¡ç®—åˆ° `LOCK_PERIOD` ç»“æŸ
- ä½¿ç”¨ 18 ä½å°æ•°ç²¾åº¦ï¼ˆ`PRECISION = 1e18`ï¼‰è¿›è¡Œé«˜ç²¾åº¦è®¡ç®—
- BASIS_POINTS = 10000ï¼ˆ100% = 10000 basis pointsï¼‰
- SECONDS_PER_YEAR = 365 days = 31,536,000 ç§’

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### é‡å…¥æ”»å‡»é˜²æŠ¤
- ä½¿ç”¨ OpenZeppelin çš„ `ReentrancyGuardUpgradeable`
- æ‰€æœ‰æ¶‰åŠèµ„é‡‘è½¬ç§»çš„å‡½æ•°éƒ½ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦

### ç´§æ€¥æ¨¡å¼
- ç®¡ç†å‘˜å¯å¯ç”¨ç´§æ€¥æ¨¡å¼
- ç´§æ€¥æ¨¡å¼ä¸‹ï¼š
  - å¥–åŠ±åˆ†é…æš‚åœ
  - ç”¨æˆ·åªèƒ½æå–æœ¬é‡‘ï¼ˆé€šè¿‡ `emergencyWithdraw`ï¼‰
  - æ–°è´¨æŠ¼è¢«é˜»æ­¢
  - è§£é™¤è´¨æŠ¼ï¼ˆ`unstake`ï¼‰è¢«ç¦ç”¨
- è¯´æ˜ï¼šç´§æ€¥æ¨¡å¼ä¸‹åªèƒ½ä½¿ç”¨ `emergencyWithdraw` æå–æœ¬é‡‘ï¼ˆæ”¾å¼ƒå¥–åŠ±ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨ `unstake`

### æš‚åœæœºåˆ¶
- ç®¡ç†å‘˜å¯æš‚åœåˆçº¦ï¼ˆ`pause()`ï¼‰
- æš‚åœæ—¶ï¼š
  - è´¨æŠ¼åŠŸèƒ½è¢«ç¦ç”¨
  - å¥–åŠ±æå–è¢«ç¦ç”¨
  - è§£é™¤è´¨æŠ¼åŠŸèƒ½è¢«ç¦ç”¨

### è®¿é—®æ§åˆ¶
- **Owner**: åˆçº¦æ‰€æœ‰è€…ï¼Œè´Ÿè´£æ‰€æœ‰ç®¡ç†åŠŸèƒ½ï¼ˆåŒ…æ‹¬å‡çº§ã€å‚æ•°é…ç½®ç­‰ï¼‰
- ä½¿ç”¨ OpenZeppelin çš„ Ownable2StepUpgradeable æ ‡å‡†å®ç°ï¼ˆä¸€æ­¥æ‰€æœ‰æƒè½¬ç§»ï¼‰
- æ”¯æŒä¸€æ­¥æ‰€æœ‰æƒè½¬ç§»ï¼š
  - ç¬¬ä¸€æ­¥ï¼šå½“å‰ owner è°ƒç”¨ `transferOwnership(newOwner)` è®¾ç½®å¾…è½¬ç§»åœ°å€
  - ç¬¬äºŒæ­¥ï¼šæ–° owner è°ƒç”¨ `acceptOwnership()` æ¥å—æ‰€æœ‰æƒ
- æ”¯æŒæ”¾å¼ƒæ‰€æœ‰æƒï¼ˆ`renounceOwnership`ï¼‰
- ä¼˜åŠ¿ï¼šé˜²æ­¢åœ°å€é”™è¯¯ã€æä¾›æ’¤é”€æœºä¼šã€å¢å¼ºå®‰å…¨æ€§

## ğŸ“ éƒ¨ç½²æŒ‡å—

### æ ‡å‡†éƒ¨ç½²ï¼ˆå•äº§å“ï¼‰

#### éƒ¨ç½²åˆ°æµ‹è¯•ç½‘

```bash
# éƒ¨ç½²Stakingï¼ˆéœ€è¦æä¾›æ—¶é—´æˆ³ï¼‰
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" npm run deploy:testnet

# éƒ¨ç½² 
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" :testnet
```

#### éƒ¨ç½²åˆ°ä¸»ç½‘

```bash
# éƒ¨ç½²Staking
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" npm run deploy

# éƒ¨ç½² 
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" 
```

**æ³¨æ„**ï¼šéƒ¨ç½²æ—¶å¿…é¡»æä¾› `STAKE_START_TIME` å’Œ `STAKE_END_TIME` ç¯å¢ƒå˜é‡ï¼ˆUnix æ—¶é—´æˆ³ï¼Œç§’çº§ï¼‰ã€‚

### å•æ± äº§å“æ–¹æ¡ˆéƒ¨ç½²

åŸºäºç°æœ‰åˆçº¦æ¶æ„ï¼Œå¯ä»¥éƒ¨ç½²å•å¥—äº§å“æ–¹æ¡ˆï¼š

#### äº§å“æ–¹æ¡ˆ

| ç‰¹æ€§ | Stakingï¼ˆå§”æ‰˜è´¨æŠ¼ï¼‰ |
|------|----------------------|
| ç›®æ ‡ç”¨æˆ· | æ‰€æœ‰ç”¨æˆ· |
| æœ€å°è´¨æŠ¼ | 1000 HSK |
| å¹´åŒ–æ”¶ç›Š | 5% |
| ç™½åå•æ¨¡å¼ | å…³é—­ï¼ˆå¼€æ”¾ï¼‰ |

#### éƒ¨ç½²æ–¹å¼

**æ–¹å¼ä¸€ï¼šåˆ†åˆ«éƒ¨ç½²**

```bash
# éƒ¨ç½²Staking
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" npm run deploy:testnet

# éƒ¨ç½² 
STAKE_START_TIME="1735689600" STAKE_END_TIME="1767225600" :testnet
```

**æ³¨æ„**ï¼šä¸€ä¸ªäº§å“éœ€è¦åˆ†åˆ«éƒ¨ç½²ï¼Œæ¯ä¸ªäº§å“éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç†åˆçº¦å’Œé…ç½®ã€‚

#### éƒ¨ç½²åé…ç½®

**æ³¨æ„**ï¼šéƒ¨ç½²è„šæœ¬éœ€è¦æä¾› `STAKE_START_TIME` å’Œ `STAKE_END_TIME` ç¯å¢ƒå˜é‡ã€‚å¦‚éœ€è°ƒæ•´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š

```bash
# è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
START_TIME="1735689600" npm run config:set-start-time:testnet

# è®¾ç½®è´¨æŠ¼ç»“æŸæ—¶é—´ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
END_TIME="1767225600" npm run config:set-end-time:testnet
```

å…¶ä»–é…ç½®ï¼š

1. **å‘å¥–åŠ±æ± å……å€¼**
   ```bash
   # Staking å¥–åŠ±æ± 
   REWARD_AMOUNT="10000" npm run rewards:add:testnet
   ```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š
- [å•æ± äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£
- [æŠ€æœ¯å¸¸è§é—®é¢˜](./docs/TECHNICAL_FAQ.md) - æŠ€æœ¯æœºåˆ¶è¯´æ˜

### éªŒè¯åˆçº¦

```bash
# ä½¿ç”¨ Foundry éªŒè¯å®ç°åˆçº¦ï¼ˆæ¨èï¼‰
IMPLEMENTATION_ADDRESS="0x..." npm run verify:forge:testnet

# éªŒè¯  å®ç°åˆçº¦
```

### å‡çº§åˆçº¦

å‡çº§è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ ProxyAdmin ç±»å‹ï¼ˆåˆçº¦æˆ– EOAï¼‰ï¼Œå¹¶ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼æ‰§è¡Œå‡çº§ï¼š

```bash
# å‡çº§åˆçº¦ï¼ˆè‡ªåŠ¨éƒ¨ç½²æ–°å®ç°ï¼Œè‡ªåŠ¨æ£€æµ‹ ProxyAdminï¼‰
npm run upgrade:testnet

# å¦‚æœ ProxyAdmin åœ°å€ä¸å½“å‰ç­¾åè€…ä¸åŒï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®š
PROXY_ADMIN_ADDRESS="0x..." npm run upgrade:testnet

# ä½¿ç”¨å·²éƒ¨ç½²çš„å®ç°åˆçº¦å‡çº§
PROXY_ADMIN_ADDRESS="0x..." NEW_IMPLEMENTATION_ADDRESS="0x..." npm run upgrade:testnet

# å‡çº§åˆçº¦
:testnet
```

**å‡çº§è„šæœ¬ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨ä»å­˜å‚¨æ§½è¯»å–å®é™…çš„ ProxyAdmin åœ°å€
- âœ… æ”¯æŒ ProxyAdmin åˆçº¦å’Œ EOA ä¸€ç§æ¨¡å¼
- âœ… è‡ªåŠ¨éªŒè¯å‡çº§å‰åçŠ¶æ€ä¸€è‡´æ€§
- âœ… å‡çº§æˆåŠŸåè‡ªåŠ¨æ‰“å°æµè§ˆå™¨é“¾æ¥
- âœ… æä¾›å‡çº§åéªŒè¯å®ç°åˆçº¦çš„å‘½ä»¤

**å‡çº§æ³¨æ„äº‹é¡¹**ï¼š
- ç¡®ä¿æ–°å®ç°åˆçº¦ä¸ç°æœ‰å­˜å‚¨å¸ƒå±€å…¼å®¹
- å‡çº§åæ‰€æœ‰çŠ¶æ€æ•°æ®ä¼šä¿ç•™
- å‡çº§å‰å»ºè®®å…ˆåœ¨æµ‹è¯•ç½‘éªŒè¯
- å‡çº§åéœ€è¦éªŒè¯æ–°å®ç°åˆçº¦ï¼ˆè„šæœ¬ä¼šæç¤ºå‘½ä»¤ï¼‰

## ğŸ”§ è„šæœ¬è¯´æ˜

### å¸¸ç”¨è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | npm å‘½ä»¤ |
|------|------|---------|
| `staking/deploy.ts` | éƒ¨ç½²Staking äº§å“ | `npm run deploy:testnet` |
| `staking/stake.ts` | æ‰§è¡Œè´¨æŠ¼ | `npm run stake:testnet` |
| `staking/unstake.ts` | è§£é™¤è´¨æŠ¼ | `npm run unstake:testnet` |
| `staking/claim-rewards.ts` | é¢†å–å¥–åŠ± | `npm run claim:testnet` |
| `staking/upgrade.ts` | å‡çº§åˆçº¦ | `npm run upgrade:testnet` |
| `staking/query/check-stakes.ts` | æŸ¥è¯¢ç”¨æˆ·è´¨æŠ¼æƒ…å†µ | `npm run query:stakes:testnet` |
| `staking/config/set-start-time.ts` | è®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´ | `npm run config:set-start-time:testnet` |
| `staking/config/set-end-time.ts` | è®¾ç½®è´¨æŠ¼æˆªæ­¢æ—¶é—´ | `npm run config:set-end-time:testnet` |
| `staking/config/set-min-stake.ts` | è®¾ç½®æœ€å°è´¨æŠ¼é‡‘é¢ | `npm run config:set-min-stake:testnet` |
| `staking/config/set-max-total-staked.ts` | è®¾ç½®æœ€å¤§æ€»è´¨æŠ¼é‡ | `npm run config:set-max-total-staked:testnet` |
| `staking/add-rewards.ts` | å‘å¥–åŠ±æ± å……å€¼ | `npm run rewards:add:testnet` |
| `staking/withdraw-excess.ts` | æå–å¤šä½™å¥–åŠ±æ± èµ„é‡‘ | `npm run withdraw-excess:testnet` |
| `staking/emergency-withdraw.ts` | ç´§æ€¥æå–æœ¬é‡‘ | `npm run emergency-withdraw:testnet` |
| `staking/config/enable-emergency.ts` | å¯ç”¨ç´§æ€¥æ¨¡å¼ | `npm run config:enable-emergency:testnet` |

### æŸ¥è¯¢è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | npm å‘½ä»¤ |
|------|------|---------|
| `staking/query/check-status.ts` | æŸ¥è¯¢åˆçº¦çŠ¶æ€ | `npm run query:status:testnet` |
| `staking/query/check-stakes.ts` | æŸ¥è¯¢ç”¨æˆ·è´¨æŠ¼æƒ…å†µ | `npm run query:stakes:testnet` |
| `staking/query/pending-reward.ts` | æŸ¥è¯¢å¾…æå–å¥–åŠ± | `npm run query:pending-reward:testnet` |
| `staking/query/position-info.ts` | æŸ¥è¯¢ä½ç½®è¯¦æƒ… | `npm run query:position-info:testnet` |

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š

```bash
npm test
# æˆ–
npm run test
```

è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶ï¼š

```bash
npm test -- test/staking/staking.test.ts
npm test -- /whitelist.test.ts
```

ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼š

```bash
npm run coverage
# æˆ–
npm run dev:coverage
```

### æµ‹è¯•ç»“æ„

```
test/
â”œâ”€â”€ staking/             # Staking å•å…ƒæµ‹è¯• å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ deployment.test.ts
â”‚   â”œâ”€â”€ staking.test.ts
â”‚   â”œâ”€â”€ rewards.test.ts
â”‚   â”œâ”€â”€ unstaking.test.ts
â”‚   â”œâ”€â”€ reward-pool.test.ts
â”‚   â”œâ”€â”€ config.test.ts
â”‚   â”œâ”€â”€ emergency.test.ts
â”‚   â””â”€â”€ edge-cases.test.ts
â”‚   â”œâ”€â”€ deployment.test.ts
â”‚   â”œâ”€â”€ staking.test.ts
â”‚   â”œâ”€â”€ rewards.test.ts
â”‚   â”œâ”€â”€ unstaking.test.ts
â”‚   â”œâ”€â”€ reward-pool.test.ts
â”‚   â”œâ”€â”€ config.test.ts
â”‚   â”œâ”€â”€ emergency.test.ts
â”‚   â”œâ”€â”€ edge-cases.test.ts
â”‚   â””â”€â”€ whitelist.test.ts
â”œâ”€â”€ e2e/                 # E2E æµ‹è¯•
â”‚   â”œâ”€â”€ user-journey.test.ts
â”‚   â””â”€â”€ emergency-scenarios.test.ts
â”œâ”€â”€ performance/         # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ gas-optimization.test.ts
â”‚   â”œâ”€â”€ batch-operations.test.ts
â”‚   â””â”€â”€ stress-test.test.ts
â””â”€â”€ helpers/             # æµ‹è¯•è¾…åŠ©å‡½æ•°
    â”œâ”€â”€ fixtures.ts
    â”œâ”€â”€ test-utils.ts
    â””â”€â”€ state-sync.ts
```

è¯¦ç»†æµ‹è¯•æŒ‡å—è¯·å‚è€ƒï¼š[æµ‹è¯•æŒ‡å—](./docs/TESTING_GUIDE.md)

## ğŸ“Š ç½‘ç»œé…ç½®

### HashKey æµ‹è¯•ç½‘
- **Chain ID**: 133
- **RPC URL**: https://hashkeychain-testnet.alt.technology
- **Explorer**: https://hashkeychain-testnet-explorer.alt.technology

### HashKey ä¸»ç½‘
- **Chain ID**: 177
- **RPC URL**: https://mainnet.hsk.xyz
- **Explorer**: https://explorer.hsk.xyz

## ğŸ“š æŠ€æœ¯æ ˆ

- **Solidity**: ^0.8.27
- **Hardhat**: ^3.0.12
- **OpenZeppelin Contracts Upgradeable**: ^5.4.0
- **TypeScript**: ^5.7.3
- **ä»£ç†æ¨¡å¼**: Transparent Proxy

## ğŸ” åˆçº¦ç‰ˆæœ¬

### å½“å‰ç‰ˆæœ¬: HSKStaking V2.0.0

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **å›ºå®š365å¤©é”å®šæœŸ**ï¼šç®€åŒ–ç”¨æˆ·æ“ä½œï¼Œæ— éœ€é€‰æ‹©é”å®šæœŸ
- **å•ä»£ç†æ¶æ„**ï¼šé€šè¿‡ `StakingProxy` å’Œ `` æ”¯æŒä¸€å¥—äº§å“æ–¹æ¡ˆ
- **Transparent Proxy æ¨¡å¼**ï¼šå‡çº§ç”± ProxyAdmin æ§åˆ¶ï¼Œå®‰å…¨å¯é 
- **ç»Ÿä¸€å®ç°åˆçº¦**ï¼š`HSKStaking.sol` ä½œä¸ºé€šç”¨å®ç°ï¼Œé€šè¿‡åˆå§‹åŒ–å‚æ•°é…ç½®ä¸åŒäº§å“
- **ç®€åŒ–çš„ stake() æ¥å£**ï¼šæ— éœ€ä¼ å…¥ lockPeriod å‚æ•°
- **å¸¸é‡åˆ†ç¦»**ï¼šå°†å¸¸é‡å®šä¹‰ç‹¬ç«‹åˆ° `StakingConstants.sol`

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå®ç°ã€å­˜å‚¨ã€å¸¸é‡ã€æ¥å£åˆ†ç¦»ï¼Œæ¸…æ™°æ˜“ç»´æŠ¤
- **å¯å¤ç”¨æ€§**ï¼šåŒä¸€å®ç°åˆçº¦æ”¯æŒå¤šä¸ªäº§å“å®ä¾‹
- **ç‹¬ç«‹å‡çº§**ï¼šå•ä¸ªä»£ç†åˆçº¦å¯ç‹¬ç«‹å‡çº§
- **çµæ´»é…ç½®**ï¼šé€šè¿‡åˆå§‹åŒ–å‚æ•°é…ç½®ä¸åŒçš„äº§å“ç‰¹æ€§

**ç‰ˆæœ¬å†å²**ï¼š
- V1.0.0 (`staking.sol`): åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒå¤šé”å®šæœŸé€‰é¡¹
- V2.0.0 (`HSKStaking.sol`): å½“å‰ç‰ˆæœ¬ï¼Œå›ºå®šé”å®šæœŸ + å•ä»£ç†æ¶æ„

## âš ï¸ é‡è¦æé†’

1. **è´¨æŠ¼æ—¶é—´çª—å£**ï¼šåˆçº¦æ”¯æŒè®¾ç½®è´¨æŠ¼å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚éƒ¨ç½²æ—¶å¿…é¡»æä¾› `STAKE_START_TIME` å’Œ `STAKE_END_TIME` ç¯å¢ƒå˜é‡ï¼ˆUnix æ—¶é—´æˆ³ï¼Œç§’çº§ï¼‰ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ `setStakeStartTime` å’Œ `setStakeEndTime` å‡½æ•°è°ƒæ•´
2. **å¥–åŠ±è®¡ç®—é™åˆ¶**ï¼šå¥–åŠ±åªè®¡ç®—åˆ°é”å®šæœŸç»“æŸï¼Œå¤šè´¨æŠ¼çš„æ—¶é—´ä¸ä¼šå¢åŠ å¥–åŠ±
3. **ç™½åå•æ¨¡å¼**ï¼šåˆçº¦æ”¯æŒç™½åå•æ¨¡å¼ï¼Œå¯åœ¨éƒ¨ç½²æ—¶é…ç½®ã€‚å½“å‰äº§å“æ–¹æ¡ˆä¸­ï¼ŒStaking å…³é—­ç™½åå•ï¼ˆå¼€æ”¾ï¼‰
4. **æœ€å°è´¨æŠ¼é‡‘é¢**ï¼šäº§å“éƒ¨ç½²æ—¶é…ç½®ä¸º 1000 HSKï¼Œéƒ¨ç½²åå¯é€šè¿‡ `setMinStakeAmount` ä¿®æ”¹
5. **æœ€å¤§æ€»è´¨æŠ¼é‡**ï¼šäº§å“éƒ¨ç½²æ—¶é…ç½®ä¸º 30,000,000 HSKï¼Œéƒ¨ç½²åå¯é€šè¿‡ `setMaxTotalStaked` ä¿®æ”¹ã€‚è®¾ç½®æ•´ä¸ªäº§å“æ± çš„ä¸Šé™ï¼Œæ‰€æœ‰ç”¨æˆ·è´¨æŠ¼é‡‘é¢æ€»å’Œä¸èƒ½è¶…è¿‡æ­¤é™åˆ¶
6. **å¥–åŠ±æ± **ï¼šç¡®ä¿å¥–åŠ±æ± æœ‰è¶³å¤Ÿèµ„é‡‘ï¼Œå¦åˆ™æ–°è´¨æŠ¼å¯èƒ½å¤±è´¥ã€‚åˆçº¦ä¼šæ£€æŸ¥å¥–åŠ±æ± ä½™é¢æ˜¯å¦è¶³å¤Ÿæ”¯ä»˜æ‰€æœ‰å¾…å‘æ”¾å¥–åŠ±
7. **å¥–åŠ±æ± æå–**ï¼šç®¡ç†å‘˜å¯ä»¥é€šè¿‡ `withdrawExcessRewardPool` æå–å¤šä½™çš„å¥–åŠ±æ± èµ„é‡‘ï¼ˆè¶…è¿‡ totalPendingRewards çš„éƒ¨åˆ†ï¼‰

### å•æ± äº§å“æ–¹æ¡ˆé…ç½®

åŸºäºç°æœ‰åˆçº¦ï¼Œå¯ä»¥éƒ¨ç½²å•å¥—äº§å“æ–¹æ¡ˆï¼š

- **Stakingï¼ˆå§”æ‰˜è´¨æŠ¼ï¼‰**ï¼š
  - æœ€å°è´¨æŠ¼ï¼š1000 HSK
  - å¹´åŒ–æ”¶ç›Šï¼š5%
  - é”å®šæœŸï¼š365å¤©
  - ç™½åå•ï¼šå…³é—­ï¼ˆå¼€æ”¾ï¼‰
  - æœ€å¤§æ€»è´¨æŠ¼é‡ï¼š30,000,000 HSKï¼ˆæ± å­ä¸Šé™ï¼‰

è¯¦ç»†äº§å“æ–¹æ¡ˆè¯·å‚è€ƒï¼š
- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£
- [å•æ± äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“å¼€å‘æ–‡æ¡£](./docs/PRODUCT_PLANS_DEV.md) - å¼€å‘å›¢é˜Ÿæ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

MIT License


---

**æ³¨æ„**ï¼šæœ¬åˆçº¦å·²é€šè¿‡å®‰å…¨å®¡è®¡ï¼Œä½†åœ¨ä¸»ç½‘éƒ¨ç½²å‰è¯·åŠ¡å¿…è¿›è¡Œå……åˆ†æµ‹è¯•ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- [è„šæœ¬ä½¿ç”¨æŒ‡å—](./scripts/README.md) - **è„šæœ¬ä½¿ç”¨å®Œæ•´æŒ‡å—ï¼ˆæ¨èï¼‰**
- [è„šæœ¬æ¶æ„æ–‡æ¡£](./docs/SCRIPTS_ARCHITECTURE.md) - è„šæœ¬æ¶æ„è¯¦è§£
- [æµ‹è¯•æŒ‡å—](./docs/TESTING_GUIDE.md) - æµ‹è¯•ç”¨ä¾‹ç¼–å†™æŒ‡å—
- [äº§å“æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./docs/PRODUCT_PLANS.md) - **è¿è¥æ–‡æ¡£ï¼ˆæ¨èï¼‰**
- [äº§å“æ–¹æ¡ˆæ‰§è¡Œæ‘˜è¦](./docs/PRODUCT_SUMMARY.md) - å¿«é€Ÿäº†è§£äº§å“æ–¹æ¡ˆ

### éƒ¨ç½²å’Œå¼€å‘
- [å•æ± äº§å“æ–¹æ¡ˆæ–‡æ¡£](./docs/DUAL_TIER_STAKING.md) - æŠ€æœ¯éƒ¨ç½²æ–‡æ¡£
- [äº§å“å¼€å‘æ–‡æ¡£](./docs/PRODUCT_PLANS_DEV.md) - å¼€å‘å›¢é˜Ÿæ–‡æ¡£
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./docs/QUICK_START_DUAL_TIER.md) - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### å‚è€ƒæ–‡æ¡£
- [æŠ€æœ¯å¸¸è§é—®é¢˜](./docs/TECHNICAL_FAQ.md) - æŠ€æœ¯æœºåˆ¶è¯´æ˜
- [é”™è¯¯å¤„ç†æŒ‡å—](./docs/ERROR_HANDLING.md) - å¸¸è§é”™è¯¯å¤„ç†

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**ç»´æŠ¤è€…**: HashKey æŠ€æœ¯å›¢é˜Ÿ
