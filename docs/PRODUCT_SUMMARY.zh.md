# HSK Staking 产品摘要

## 🎯 产品概览

HSKStaking 是一个具有固定配置参数的单质押池。所有用户参与同一个质押池。

| 特性 | 说明 |
|---------|-------------|
| **合约类型** | HSKStaking（单一合约实现） |
| **锁定期** | 365 天（固定，合约常量） |
| **最小质押** | 1 HSK |
| **年化收益率** | 5%（基础 APY，合约实时结算） |
| **总预期年化** | Up to 8%（前端展示，包含忠诚度补贴 1%-3%） |
| **最大总质押量** | 30,000,000 HSK（3000 万 HSK） |
| **白名单模式** | 默认禁用（对所有用户开放） |
| **质押窗口期** | 约 7 天（管理员可配置） |
| **提前解除质押** | 支持（50% 罚金，7 天等待期） |
| **收益计算** | 线性，按秒累积 |

---

## 📋 核心机制

### 参与方式
- ✅ 最小质押金额：1 HSK
- ✅ 白名单模式：默认禁用（对所有用户开放）
- ✅ 质押时间窗口：约 7 天（只能在管理员设置的时间范围内质押）
- ✅ 固定锁定期：365 天
- ✅ 最大总质押量：30,000,000 HSK（池子上限）

### 收益规则
- ✅ 基础年化收益率：5%（合约实时结算）
- ✅ 总预期年化：Up to 8%（前端展示，包含忠诚度补贴 1%-3%）
- ✅ 忠诚度补贴：1%-3%（链下发放，不在合约中）
- ✅ 忠诚度补贴分配：Staking 活动结束后，根据持仓用户在 staking 总数的占比，等比例一次性分配给质押完整的用户（完成完整质押周期 365 天）
- ✅ 基于实际质押秒数计算收益
- ✅ 锁定期内可单独提取奖励
- ✅ 收益只计算到锁定期结束（365 天）

### 解锁和提取规则

**正常解除质押**：
- 🔒 **锁定期内（365 天）**：不能解除质押，只能提取奖励
- ✅ **锁定期结束后（365 天后）**：可以解除质押，提取本金 + 全部奖励
- ✅ **解锁时间**：解锁时间 = 质押时间 + 365 天
- ✅ **奖励提取**：锁定期内可随时提取已累积奖励

**提前解除质押**：
- ✅ **申请提前解除质押**：锁定期内可以申请
- ⏳ **等待期**：申请后需等待 7 天
- ⚠️ **罚金**：50% 的收益被罚没（转入罚金池）
- ✅ **完成提前解除质押**：7 天等待期后，可以完成并收到本金 + 50% 的收益
- ⚠️ **收益计算**：收益计算到申请时间，不是完成时间

**紧急提取**：
- 🚨 **紧急模式**：紧急模式下可随时提取本金（放弃奖励）
- ⚠️ **需要管理员**：管理员必须先启用紧急模式

### 风险控制
- ✅ 最大总质押量：30,000,000 HSK（固定池子上限）
- ✅ 奖励池余额检查：合约检查奖励池余额是否足够支付所有待发放奖励
- ✅ 白名单机制：默认禁用（管理员可按需启用）
- ✅ 紧急模式：特殊情况下只能提取本金
- ✅ 暂停功能：管理员可以暂停/恢复合约

---

## ⚠️ 重要机制说明

### 1. 解锁规则

**关键点**：
- **锁定期内**：不能正常解除质押，只能提取奖励或申请提前解除质押
- **锁定期结束后**：可以解除质押，提取本金 + 全部奖励
- **解锁时间**：解锁时间 = 质押时间 + 365 天

**示例**：
- 用户在 2026-11-01 质押，固定 365 天锁定期
- 解锁时间：2027-11-01（365 天后）
- 锁定期内（直到 2027-11-01）：只能提取奖励或申请提前解除质押
- 锁定期结束后（2027-11-01 之后）：可以解除质押，提取本金 + 全部奖励

### 2. 提前解除质押机制

**关键点**：
- **申请**：用户可以在锁定期内申请提前解除质押
- **等待期**：申请后必须等待 7 天才能完成
- **罚金**：50% 的收益被罚没（转入罚金池）
- **收益计算**：收益计算到申请时间，不是完成时间
- **罚金池**：分配给完成完整质押周期的用户

**示例**：
- 用户在 Day 0 质押 100 HSK
- 用户在 Day 60 申请提前解除质押
- 收益只计算到 Day 60（不是 Day 67）
- 用户收到 50% 的计算收益
- 50% 罚金转入罚金池

### 3. 收益计算规则

**关键点**：收益只计算到锁定期结束，超期时间不会增加收益

**示例**：
- 用户选择 365 天锁定期，5% 年化收益率
- 实际质押了 400 天才提取
- 收益仍按 365 天计算
- **重要**：超过锁定期的时间不会产生额外收益，收益只计算到锁定期结束

### 4. 白名单机制

**配置**：
- 白名单模式：默认禁用
- 所有用户可以自由参与
- 管理员可以在部署后启用白名单模式（如需要）
- 如果启用：只有白名单用户才能质押

### 5. 奖励池管理

**管理**：
- 每个合约实例有独立的奖励池
- 管理员必须向奖励池充值
- 合约在允许新质押前检查奖励池余额是否充足
- 管理员可以提取超额奖励（超过总待发放奖励的部分）

### 6. 罚金池分配

**机制**：
- 提前解除质押的罚金进入罚金池
- 罚金池在合约中累积
- **分配时间**：Staking 活动结束后，所有质押都到期之后
- **分配方式**：链下统计，一次性分配
- **分配规则**：根据持仓用户在 staking 总数的占比，等比例分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得罚金池分配

### 7. 紧急提取机制

**机制概述**：
- 仅在管理员启用紧急模式后可用
- 允许用户在锁定期内提取本金，但放弃所有奖励
- 不受锁定期限制，可以随时提取

**触发条件**：
- 管理员必须启用紧急模式

**功能说明**：
- **紧急提取**：
  - 不受锁定期限制，可以随时提取
  - 只能提取本金，不包括奖励
  - 提取后质押位置关闭

- **紧急模式下的其他限制**：
  - 奖励分发暂停
  - 新质押被阻止
  - 正常解除质押功能暂停

**使用场景**：
- 合约紧急情况或安全风险
- 需要快速恢复用户本金
- 系统维护或升级
- 不可预见的紧急情况

---

## 📊 关键运营指标

- 总质押金额
- 参与用户数量
- 平均质押金额
- 奖励池余额
- 总待发放奖励
- 罚金池余额
- 提前解除质押申请数量
- 完成完整质押周期的数量

---

## 🎯 运营建议

- **推广**：强调灵活配置和稳定收益
- **用户教育**：重点解释锁定期、收益计算和提前解除质押机制
- **奖励池**：定期充值，确保资金充足
- **罚金池**：监控罚金池余额，在质押期结束后计划分配
- **白名单管理**：如果启用白名单，建立审批标准和定期审查

---

## 📝 运营注意事项

1. **奖励池管理**
   - 每个合约实例需要独立的奖励池
   - 定期检查余额
   - 提前计划充值
   - 确保有足够资金支付所有待发放奖励

2. **白名单管理**（如果启用）
   - 建立审批标准
   - 定期审查用户
   - 及时添加/移除

3. **提前解除质押**
   - 用户可以在锁定期内申请提前解除质押
   - 需要 7 天等待期
   - 适用 50% 罚金
   - 罚金池分配给完成完整质押周期的用户

4. **罚金池分配**
   - 仅在质押期结束后（`stakeEndTime`）
   - 仅分配给完成完整质押周期的用户
   - 基于质押金额的比例分配

5. **风险控制**
   - 监控总质押金额
   - 关注奖励池余额
   - 制定应急预案

---

## 🔑 关键特性总结

| 特性 | 说明 |
|---------|-------------|
| **最小质押** | 1 HSK |
| **锁定期** | 365 天（固定） |
| **基础 APY** | 5%（合约实时结算） |
| **总预期 APY** | Up to 8%（前端展示） |
| **最大总质押量** | 30,000,000 HSK |
| **白名单** | 默认禁用 |
| **质押窗口期** | 约 7 天 |
| **提前解除质押** | 支持（50% 罚金，7 天等待期） |
| **收益计算** | 按秒，线性累积 |
| **紧急模式** | 支持 |
| **暂停功能** | 支持 |
| **罚金池** | 活动结束后分配给完整质押用户 |

---

**完整文档请参考**：[产品方案文档](./PRODUCT_PLANS.md)

---

## 📚 相关文档

- [主 README](../README.md)
- [产品方案文档](./PRODUCT_PLANS.md) - **运营文档（推荐）**
- [HSK Staking 文档](./DUAL_TIER_STAKING.md) - 技术部署文档
- [产品开发文档](./PRODUCT_PLANS_DEV.md) - 开发团队文档
- [快速开始指南](./QUICK_START_DUAL_TIER.md) - 快速部署指南
- [技术 FAQ](./TECHNICAL_FAQ.md) - 技术机制说明
- [错误处理指南](./ERROR_HANDLING.md) - 常见错误处理
- [提前解除质押更新日志](./EARLY_UNSTAKE_CHANGELOG.md) - 提前解除质押功能详情

---

**文档版本**: 2.0.0  
**维护者**: HashKey 技术团队
