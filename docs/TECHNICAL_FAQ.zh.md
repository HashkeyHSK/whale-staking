# 常见问题解答（FAQ）

本文档用于快速回复用户常见问题。

---

## 一. 奖励相关

### Q1: 奖励是线性解锁吗？是区块解锁吗？

**A:** 奖励是线性解锁，基于时间计算（不是区块解锁）。

- 奖励按秒连续累积，每秒都在产生收益
- 与区块出块速度无关，只与时间相关
- 可以随时提取已累积的奖励，精确到秒

**示例**：质押 10,000 HSK，年化 5%，第 30 天可提取约 65.75 HSK 奖励（2,592,000秒累积的奖励）。

---

### Q2: 年化收益率是什么意思？365 天年化 5% 是 365 天后得到 5% 收益吗？

**A:** 是的。年化收益率是按年计算的收益率。

- **年化 5%** 意思是：如果质押满 365 天，收益是 5%
- 实际收益 = 本金 × 年化率 × (实际质押秒数 / 365天的秒数)
- 如果质押时间少于 365 天，收益按比例计算（精确到秒）

**示例1**：质押 10,000 HSK，年化 5%，质押 365 天：
- 收益 = 10,000 × 5% × (365/365) = 500 HSK

**示例2**：质押 10,000 HSK，年化 5%，质押 365 天，但在第100天提取奖励：
- 第100天可提取奖励 = 10,000 × 5% × (100/365) ≈ 219.18 HSK
- 本金继续锁定，继续产生奖励

---

### Q3: 奖励什么时候可以提取？

**A:** 锁定期内可以随时提取奖励，不需要等到锁定期结束。

- 奖励会持续累积，随时可以提取
- 提取奖励后，本金继续锁定，继续获得奖励
- 锁定期结束后，解除质押时会自动提取所有奖励

---

### Q4: 如果超过锁定期还没提取，奖励会继续增加吗？

**A:** 不会。奖励只计算到锁定期结束。

- 奖励上限 = 本金 × 年化率 × (锁定期 / 365天)
- 超过锁定期的时间不会产生额外奖励
- 建议锁定期结束后及时提取

**示例**：选择 365 天锁定期，年化 5%，实际质押了 400 天：
- 奖励仍按 365 天计算 = 10,000 × 5% = 500 HSK
- 多出的 35 天不会产生额外奖励

---

### Q5: 奖励池余额不足怎么办？

**A:** 奖励池由管理员充值维护。

- 如果奖励池余额不足，无法提取奖励
- 请联系管理员充值奖励池
- 奖励会累积，等奖励池充值后可以提取

---

## 二. 质押相关

### Q6: 什么是质押时间窗口？

**A:** 质押时间窗口是指允许用户进行质押的时间范围。

- 管理员可以设置质押开始时间（`stakeStartTime`）和结束时间（`stakeEndTime`）
- 用户只能在 `stakeStartTime <= 当前时间 < stakeEndTime` 期间进行质押
- 部署脚本默认设置开始时间为部署后7天
- 管理员可以随时调整这个时间窗口


---

### Q7: 质押后会获得类似 st token 的代币吗？

**A:** 不会。质押后不会产生任何代币。

- 质押后只获得一个 `positionId`（质押位置 ID）
- 没有可交易的代币
- 质押位置不可转让，绑定您的地址

---

### Q8: 最小质押金额是多少？

**A:** 最小质押金额为 **1 HSK**。

- 单笔质押金额必须 ≥ 1 HSK
- 可以多次质押，每次质押会创建新的质押位置

---

### Q9: 最大总质押量是什么意思？是单笔限制吗？

**A:** 不是单笔限制，是整个产品池的上限。

- 是所有用户质押金额总和的上限
- **最大总质押量：3,000 万 HSK（30,000,000 HSK）**
- 单笔可以质押任意金额（只要不超过池子上限）
- 达到上限后，新用户无法质押，需要等有用户解除质押

**示例**：
- 如果已有 2,500 万 HSK 被质押，新用户最多只能质押 500 万 HSK
- 如果已有 3,000 万 HSK 被质押，新用户无法质押，需要等待其他用户解除质押

**管理员功能**：
- 管理员可以通过 `setMaxTotalStaked()` 函数调整最大总质押量
- 设置为 0 表示无限制

---

### Q10: 可以多次质押吗？

**A:** 可以。每次质押会创建一个新的质押位置。

- 每个质押位置独立计算奖励
- 可以同时持有多个质押位置
- 每个位置可以独立提取奖励和解除质押

---

### Q11: 需要白名单吗？

**A:** **默认不需要白名单**。


---

## 三. 锁定期和提取

### Q12: 锁定期内可以解除质押吗？

**A:** 锁定期内有两种方式解除质押：

1. **正常解除质押**：锁定期结束后（365天后）可以解除质押，提取本金 + 全部奖励
2. **提前解除质押**：锁定期内可以申请提前解除，但需要：
   - 等待 7 天冷静期
   - 支付 50% 收益作为罚金
   - 从申请时起不再产生新收益

**锁定期内（365天内）**：
- ✅ 可以提取奖励（本金继续锁定）
- ✅ 可以申请提前解除质押（需支付罚金）
- ❌ 不能立即解除质押（需等待冷静期）

---

### Q13: 锁定期有多长？

**A:** HSKStaking 采用固定365天锁定期。

- Staking：365 天（固定，约 31,536,000 秒）
- ：365 天（固定，约 31,536,000 秒）
- V2 版本简化了锁定期选择，所有质押统一为365天
- 锁定期是合约中的常量 `LOCK_PERIOD`，部署后不可修改

---

### Q14: 锁定期结束后必须立即提取吗？

**A:** 不是。锁定期结束后可以随时提取。

- 锁定期结束后，可以随时解除质押
- 但超过锁定期的时间不会产生额外奖励
- 建议及时提取，避免资金闲置

---

### Q15: 解除质押时，奖励会自动提取吗？

**A:** 是的。解除质押时会自动提取本金 + 全部累积奖励。

- 不需要先提取奖励再解除质押
- 一次操作即可提取本金和所有奖励

---

### Q16: 什么是紧急提取？什么时候可以用？

**A:** 紧急提取是特殊情况下提取本金的功能。

- 仅在管理员启用紧急模式时可用
- 可以随时提取，不受锁定期限制
- **只能提取本金，放弃全部奖励**
- 用于紧急情况，不建议常规使用

---

### Q16-1: 锁定期内可以提前解除质押吗？

**A:** 可以，但需要支付罚金。

- **提前解除质押**：锁定期内可以申请提前解除质押
- **冷静期**：申请后需要等待 7 天冷静期才能完成解除
- **罚金**：提前解除需要支付 50% 的收益作为罚金
- **收益停止**：从申请提前解除的那一刻起，不再产生新的收益

**流程**：
1. 调用 `requestEarlyUnstake(positionId)` 申请提前解除
2. 等待 7 天冷静期
3. 调用 `completeEarlyUnstake(positionId)` 完成解除

**重要说明**：
- **二期由于实时收益，不能提前解除质押**
- 当前版本支持提前解除质押功能
- 如果后续版本改为实时收益模式，将不支持提前解除质押

---

### Q16-2: 提前解除质押的罚金如何计算？

**A:** 罚金 = 总收益 × 50%

**计算规则**：
- **总收益**：只计算到申请提前解除的时间点（`requestTime`）
- **用户保留**：总收益的 50%（`EARLY_UNSTAKE_REWARD_RETAIN_RATE = 5000`）
- **罚金**：总收益的 50%，转入罚金池（Penalty Pool）
- **冷静期内**：不产生新收益，收益计算在申请时已停止

**示例**：
- 质押：10,000 HSK，年化 5%
- 第 60 天申请提前解除，此时总收益 = 10,000 × 5% × (60/365) ≈ 82.19 HSK
- 用户保留：82.19 × 50% = 41.10 HSK
- 罚金：82.19 × 50% = 41.10 HSK（转入罚金池）
- 第 67 天完成解除（7 天冷静期后），收益仍按第 60 天计算

**特殊情况**：
- 如果已领取的收益超过允许保留的 50%，超出部分会从本金中扣除
- 例如：总收益 100 HSK，允许保留 50 HSK，但已领取 60 HSK
  - 超出部分：60 - 50 = 10 HSK
  - 从本金扣除 10 HSK，最终返还本金 = 10,000 - 10 = 9,990 HSK

**罚金池分配机制**：
- 所有提前退出罚没的 50% 收益进入罚金池
- **分配时间**：Staking 活动结束后，所有质押都到期之后
- **分配方式**：链下统计，根据持仓用户在 staking 总数的占比，等比例一次性分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得罚金池分配

---

### Q16-3: 冷静期内还会产生收益吗？

**A:** 不会。从申请提前解除的那一刻起，收益计算就停止了。

- **申请时**：收益计算截止到申请时间点（`requestTime`）
- **冷静期内**：不再产生新收益
- **完成解除时**：仍按申请时的收益计算，不会增加

**查询收益**：
- 使用 `pendingReward(positionId)` 查询时，如果已申请提前解除，会显示申请时的收益
- 冷静期内查询的收益不会增加

---

### Q16-4: 如何查询提前解除质押的罚金？

**A:** 后端可以通过以下方式计算：

1. **查询是否已申请**：`earlyUnstakeRequestTime[positionId]`
2. **获取仓位信息**：`positions(positionId)`
3. **计算总收益**：从 `stakedAt` 到 `requestTime` 的收益
4. **计算罚金**：总收益 × 50%

**计算公式**：
```
总收益 = 本金 × 年化率 × (requestTime - stakedAt) / 365天
罚金 = 总收益 × 50%
用户保留 = 总收益 × 50%
```

**注意**：合约没有提供直接的查询函数，需要通过事件 `EarlyUnstakeCompleted` 获取，或后端自行计算。

---

### Q16-5: 罚金池奖励什么时候发放？

**A:** 罚金池奖励在 **Staking 活动结束后，所有质押都到期之后** 发放。

- **发放时间**：活动结束之后，所有质押都到期之后
- **发放方式**：链下统计，一次性发放
- **分配规则**：根据持仓用户在 staking 总数的占比，等比例分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得罚金池分配
- **提前解除质押的用户**：不能获得罚金池分配

**示例**：
- 假设罚金池总额：100,000 HSK
- 用户A质押：1,000,000 HSK（完整365天）
- 用户B质押：500,000 HSK（完整365天）
- 总完整质押：10,000,000 HSK
- 用户A分配：100,000 × (1,000,000 / 10,000,000) = 10,000 HSK
- 用户B分配：100,000 × (500,000 / 10,000,000) = 5,000 HSK

---

## 四. 收益计算

### Q17: 如何计算我的收益？

**A:** 收益计算公式：

```
收益 = 本金 × 年化率 × (实际质押天数 / 365天)
```

**限制**：如果实际质押天数 > 锁定期，则按锁定期计算。

**正常情况示例**：
- 本金：10,000 HSK
- 年化率：5%
- 锁定期：365 天
- 实际质押：365 天
- 收益 = 10,000 × 5% × (365/365) = 500 HSK

**提前解除质押示例**：
- 本金：10,000 HSK
- 年化率：5%
- 第 60 天申请提前解除
- 总收益 = 10,000 × 5% × (60/365) ≈ 82.19 HSK
- 用户保留 = 82.19 × 50% = 41.10 HSK
- 罚金 = 82.19 × 50% = 41.10 HSK
- **注意**：第 60-67 天（冷静期）不产生收益

---

### Q18: 年化收益率是多少？

**A:** 基础年化收益率为 **5%**。

- **基础 APY**：5%（由智能合约实时结算）
- **总预期年化**：Up to 8%（前端展示，包含额外补贴）
  - 基础收益：5%
  - 忠诚度补贴：+1% ~ +3%（链下发放，不在合约中）

**注意**：
- 基础 APY（5%）由智能合约实时结算
- 额外补贴（1%-3%）为链下发放，不在合约中
- 额外补贴将于质押期满后结算

---

### Q18: 奖励是按天发放还是按月发放？

**A:** 奖励是线性累积的，按秒计算。

- 不是按天或按月发放，而是每秒都在累积
- 奖励持续累积，随时可以提取，精确到秒
- 提取时计算从上次提取到现在的所有奖励（精确到秒）

**特殊情况 - 提前解除质押**：
- 如果申请了提前解除质押，从申请时起不再产生新收益
- 收益计算截止到申请时间点，冷静期内不增加收益

---

## 五. 活动规则和额外补贴

### Q19: 活动规则说明

**A:** 活动规则如下：

**1. 收益构成**
- 用户最终收益 = 基础 APY (5%) + 额外补贴 APY (1%-3%)
- 基础 APY 由智能合约实时结算
- 额外补贴为一次性发放，将于质押期满后结算

**2. 补贴资格**
- 本补贴仅面向再次参与质押的老用户

**3. 补贴阶梯**
根据您的实际质押时长计算额外补贴率：
- ≥ 1个月 且 < 6个月：+1% APY
- ≥ 6个月 且 < 12个月：+2% APY
- 12个月（完整365天）：+3% APY

**4. 特殊结算机制**
- **提前赎回机制**：若您设定质押期为 12 个月（原定补贴 3%），但实际在第 4 个月赎回，系统将降级按"3个月标准"结算，即仅发放 1% 的额外补贴
- **多笔质押计算**：若您同时存在多笔质押订单，额外补贴将按照您实际持有的最长质押周期对应的档位统一计算

**5. 分配机制**
- 额外补贴为链下发放，不在合约中
- **分配时间**：Staking 活动结束后，所有质押都到期之后
- **分配方式**：链下统计，一次性分配
- **分配规则**：根据持仓用户在 staking 总数的占比，等比例一次性分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得
- **提前解除质押用户**：不能获得忠诚度补贴分配

**6. 重要说明**
- 忠诚度补贴为链下发放，不在合约中
- 补贴金额将在 Staking 活动结束后统一计算和分配

---

### Q19-1: 总预期年化收益率是多少？

**A:** 总预期年化收益率：**Up to 8%**

**收益构成**：
- **基础收益（Base）**：5%（由智能合约实时结算）
- **忠诚度补贴（Loyalty Bonus）**：+1% ~ +3%（链下发放，不在合约中）

**忠诚度补贴阶梯**：
- ≥ 1个月 且 < 6个月：+1% APY
- ≥ 6个月 且 < 12个月：+2% APY
- 12个月（完整365天）：+3% APY

**分配机制**：
- 基础 APY（5%）由智能合约实时结算
- 额外补贴（1%-3%）为链下发放，不在合约中
- **分配时间**：Staking 活动结束后，所有质押都到期之后
- **分配方式**：链下统计，一次性分配
- **分配规则**：根据持仓用户在 staking 总数的占比，等比例一次性分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得
- **提前解除质押用户**：不能获得忠诚度补贴分配

**注意**：
- 忠诚度补贴为链下发放，不在合约中
- 补贴金额将在 Staking 活动结束后统一计算和分配

---

### Q19-1: 忠诚度补贴如何计算？

**A:** 忠诚度补贴根据实际质押时长计算额外补贴率。

**补贴阶梯**：
- ≥ 1个月 且 < 6个月：+1% APY
- ≥ 6个月 且 < 12个月：+2% APY
- 12个月（完整365天）：+3% APY

**特殊结算机制**：
- **提前赎回机制**：若您设定质押期为 12 个月（原定补贴 3%），但实际在第 4 个月赎回，系统将降级按"3个月标准"结算，即仅发放 1% 的额外补贴
- **多笔质押计算**：若您同时存在多笔质押订单，额外补贴将按照您实际持有的最长质押周期对应的档位统一计算

**补贴资格**：
- 本补贴仅面向再次参与质押的老用户
- 需要完成完整质押周期才能获得对应档位的补贴

**分配机制**：
- **分配时间**：Staking 活动结束后，所有质押都到期之后
- **分配方式**：链下统计，一次性分配
- **分配规则**：根据持仓用户在 staking 总数的占比，等比例一次性分配给质押完整的用户
- **分配条件**：只有完成完整质押周期（365天）的用户才能获得
- **提前解除质押用户**：不能获得忠诚度补贴分配

---

### Q20: 可以多次质押吗？

**A:** 可以。每次质押会创建一个新的质押位置。

- 可以同时持有多个质押位置
- 每个质押位置独立计算奖励
- 每个位置可以独立提取奖励和解除质押
- 多笔质押的忠诚度补贴按最长质押周期对应的档位统一计算

---

## 六. 技术问题

### Q21: 如何查询我的质押信息？

**A:** 通过合约函数查询。

- 使用 `getUserPositionIds(address)` 获取用户的所有质押位置ID（推荐）
- 使用 `positions(positionId)` 查询指定位置的详细信息
- 使用 `pendingReward(positionId)` 查询待提取奖励（任何人都可以查询，无所有者限制）
- 使用 `earlyUnstakeRequestTime(positionId)` 查询是否已申请提前解除质押
- 使用 `claimedRewards(positionId)` 查询已领取的收益总额
- 可以通过前端界面或调用合约函数查询
- **注意**: `pendingReward` 可以被任何人调用 - 不需要是位置所有者

**提前解除质押状态查询**：
- 如果 `earlyUnstakeRequestTime[positionId] > 0`，表示已申请提前解除
- 可以计算冷静期剩余时间：`requestTime + 7天 - 当前时间`
- 罚金可以通过后端计算：总收益（到申请时间）× 50%

---

### Q22: 质押需要支付 Gas 费吗？

**A:** 需要。所有链上操作都需要支付 Gas 费。

- 质押、提取奖励、解除质押都需要 Gas 费
- Gas 费由网络决定，不是产品收取

---

## 七. 其他问题

### Q23: 如果遇到问题，如何联系客服？

**A:** 请联系官方客服或管理员。

- 技术问题：联系开发团队
- 白名单申请：联系管理员
- 奖励池问题：联系管理员

---

## 八. 快速参考

### 产品信息表

| 项目 | 说明 |
|------|------|
| **年化收益率** | 基础 5%（合约实时结算）+ 忠诚度补贴 1%-3%（链下发放） |
| **总预期年化** | Up to 8%（前端展示） |
| **最小质押** | 1 HSK |
| **锁定期** | 365 天（固定，LOCK_PERIOD常量） |
| **参与方式** | 开放（默认无白名单） |
| **最大总质押量** | 30,000,000 HSK（3,000 万 HSK） |
| **质押窗口期** | 预计 7 天 |
| **提前解除质押** | 支持（需等待 7 天冷静期，支付 50% 罚金） |

### 重要提醒

1. **质押时间窗口**：质押窗口期预计只有 7 天，只能在管理员设置的时间窗口内进行质押
2. **年化收益率**：基础 APY 5% 由合约实时结算，额外补贴 1%-3% 为链下发放（不在合约中）
3. **奖励上限**：奖励只计算到锁定期结束，超期不增加
4. **锁定期限制**：锁定期内可以申请提前解除质押，但需支付50%罚金并等待7天冷静期
5. **提前解除质押**：从申请时起不再产生新收益，冷静期内收益不增加
6. **罚金池分配**：活动结束后，所有质押到期后，链下统计，按比例分配给完整质押用户
7. **奖励池**：奖励由管理员充值，如果余额不足可能无法提取
8. **紧急模式**：紧急模式下只能提取本金，放弃奖励
9. **忠诚度补贴**：链下发放，活动结束后统一计算和分配

---

---

## 📚 相关文档

- [主 README](../README.md)
- [合约架构说明](./CONTRACT_ARCHITECTURE.md) - **合约架构详解（开发必读）**
- [产品方案详细文档](./PRODUCT_PLANS.md) - **运营文档（推荐）**
- [产品方案执行摘要](./PRODUCT_SUMMARY.md) - 快速了解
- [单层产品方案文档](./DUAL_TIER_STAKING.md) - 技术部署文档
- [产品开发文档](./PRODUCT_PLANS_DEV.md) - 开发团队文档
- [快速开始指南](./QUICK_START_DUAL_TIER.md) - 快速部署指南
- [错误处理指南](./ERROR_HANDLING.md) - 常见错误处理

---

**文档版本**: 1.0.0  
**维护者**: HashKey 技术团队
